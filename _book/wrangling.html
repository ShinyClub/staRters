<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 10 Data Wrangling | staRters; An introductory workshop for analysis of data with R</title>
  <meta name="description" content="HU Ontwikkelfestival, 2-4 November, 2020" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 10 Data Wrangling | staRters; An introductory workshop for analysis of data with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="HU Ontwikkelfestival, 2-4 November, 2020" />
  <meta name="github-repo" content="uashogeschoolutrecht/staRters" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 10 Data Wrangling | staRters; An introductory workshop for analysis of data with R" />
  
  <meta name="twitter:description" content="HU Ontwikkelfestival, 2-4 November, 2020" />
  

<meta name="author" content="Marc A.T. Teunis, PhD" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="viz.html"/>
<link rel="next" href="tidydata.html"/>
<script src="libs/header-attrs-2.4/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.2/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.15/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<script src="libs/d3-5.7.0/d3.min.js"></script>
<script src="libs/d3-lasso-0.0.5/d3-lasso.min.js"></script>
<link href="libs/ggiraphjs-0.3.0/ggiraphjs.min.css" rel="stylesheet" />
<script src="libs/ggiraphjs-0.3.0/ggiraphjs.min.js"></script>
<script src="libs/girafe-binding-0.7.8/girafe.js"></script>
<link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet" />
<script src="libs/str_view-binding-1.4.0/str_view.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Analysis with R for staRters</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="why-r.html"><a href="why-r.html"><i class="fa fa-check"></i><b>2</b> Why use R?</a></li>
<li class="chapter" data-level="3" data-path="gettingstarted.html"><a href="gettingstarted.html"><i class="fa fa-check"></i><b>3</b> Getting Started</a></li>
<li class="chapter" data-level="4" data-path="edacase.html"><a href="edacase.html"><i class="fa fa-check"></i><b>4</b> Case Example</a></li>
<li class="chapter" data-level="5" data-path="introrstudio.html"><a href="introrstudio.html"><i class="fa fa-check"></i><b>5</b> Introduction to RStudio</a></li>
<li class="chapter" data-level="6" data-path="rmarkdown.html"><a href="rmarkdown.html"><i class="fa fa-check"></i><b>6</b> Literate Programming with RMarkdown</a></li>
<li class="chapter" data-level="7" data-path="intror.html"><a href="intror.html"><i class="fa fa-check"></i><b>7</b> Introduction to R</a></li>
<li class="chapter" data-level="8" data-path="recursivevectors.html"><a href="recursivevectors.html"><i class="fa fa-check"></i><b>8</b> Lists and dataframes</a></li>
<li class="chapter" data-level="9" data-path="viz.html"><a href="viz.html"><i class="fa fa-check"></i><b>9</b> Visualize &amp; Explore Data</a></li>
<li class="chapter" data-level="10" data-path="wrangling.html"><a href="wrangling.html"><i class="fa fa-check"></i><b>10</b> Data Wrangling</a></li>
<li class="chapter" data-level="11" data-path="tidydata.html"><a href="tidydata.html"><i class="fa fa-check"></i><b>11</b> Tidy Data</a></li>
<li class="chapter" data-level="12" data-path="importingdata.html"><a href="importingdata.html"><i class="fa fa-check"></i><b>12</b> Importing data</a></li>
<li class="chapter" data-level="13" data-path="assumptions.html"><a href="assumptions.html"><i class="fa fa-check"></i><b>13</b> Assumptions and statistical models</a></li>
<li class="chapter" data-level="14" data-path="sampling-bootstrapping.html"><a href="sampling-bootstrapping.html"><i class="fa fa-check"></i><b>14</b> Sampling, Probability distributions and bootstrapping</a></li>
<li class="chapter" data-level="15" data-path="resources.html"><a href="resources.html"><i class="fa fa-check"></i><b>15</b> Resources</a></li>
<li class="divider"></li>
<li><a href="https://github.com/uashogeschoolutrecht/staRters" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">staRters; An introductory workshop for analysis of data with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="wrangling" class="section level1" number="10">
<h1><span class="header-section-number">Chapter 10</span> Data Wrangling</h1>
<div id="packages" class="section level2" number="10.1">
<h2><span class="header-section-number">10.1</span> Packages</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="wrangling.html#cb1-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="wrangling.html#cb1-2"></a><span class="kw">library</span>(dslabs)</span></code></pre></div>
</div>
<div id="citations" class="section level2" number="10.2">
<h2><span class="header-section-number">10.2</span> Citations</h2>
<p>To get the citations for the packages used in this chapter.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="wrangling.html#cb2-1"></a><span class="kw">citation</span>(<span class="dt">package =</span> <span class="st">&quot;tidyverse&quot;</span>)</span>
<span id="cb2-2"><a href="wrangling.html#cb2-2"></a><span class="kw">citation</span>(<span class="dt">package =</span> <span class="st">&quot;dplyr&quot;</span>)</span></code></pre></div>
</div>
<div id="case-data" class="section level2" number="10.3">
<h2><span class="header-section-number">10.3</span> Case Data</h2>
<ul>
<li>Pertussis outbreaks from The World Health Organization</li>
<li><a href="http://data.euro.who.int/cisid/?TabID=463987" class="uri">http://data.euro.who.int/cisid/?TabID=463987</a></li>
<li><a href="http://ecdc.europa.eu/sites/portal/files/documents/Pertussis%20AER.pdf" class="uri">http://ecdc.europa.eu/sites/portal/files/documents/Pertussis%20AER.pdf</a></li>
<li>The data used in this presentation has been constructed from the interactive database tool hosted at: <a href="http://data.euro.who.int/cisid/" class="uri">http://data.euro.who.int/cisid/</a></li>
<li>A selection was made for all available countries and all available years, for the number of cases reported to the WHO for Whooping Cough - pertussis infections</li>
<li>The file is avaialble in <code>./data/CISID_pertussis_10082018.csv</code></li>
<li>The values included here in the dataset are the total reported cases, per country per year</li>
<li>At the start of the file there are remarks and metadata indicated by <code>#</code></li>
<li>Missing values are indicated with an empty string</li>
</ul>
<p>Open the file to inspect. The delimeter is <code>,</code> and you should see the comments at the start of the file.</p>
<div id="read-data" class="section level3 unnumbered" number="">
<h3>Read data</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="wrangling.html#cb3-1"></a>pertussis_data &lt;-<span class="st"> </span><span class="kw">read_csv</span>(</span>
<span id="cb3-2"><a href="wrangling.html#cb3-2"></a>  <span class="dt">file =</span> here<span class="op">::</span><span class="kw">here</span>( </span>
<span id="cb3-3"><a href="wrangling.html#cb3-3"></a>                  <span class="st">&quot;data&quot;</span>, </span>
<span id="cb3-4"><a href="wrangling.html#cb3-4"></a>                  <span class="st">&quot;CISID_pertussis_10082018.csv&quot;</span>),</span>
<span id="cb3-5"><a href="wrangling.html#cb3-5"></a>                           <span class="dt">comment =</span> <span class="st">&quot;#&quot;</span>, </span>
<span id="cb3-6"><a href="wrangling.html#cb3-6"></a>                           <span class="dt">na =</span> <span class="kw">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot; &quot;</span>)</span>
<span id="cb3-7"><a href="wrangling.html#cb3-7"></a>  )</span></code></pre></div>
<pre><code>## Warning: Missing column names filled in: &#39;X1&#39; [1], &#39;X2&#39; [2]</code></pre>
<pre><code>## 
## -- Column specification --------------------------------------------------------
## cols(
##   .default = col_double(),
##   X2 = col_character(),
##   `1980` = col_logical(),
##   `1981` = col_logical(),
##   `1982` = col_logical(),
##   `1983` = col_logical(),
##   `1984` = col_logical(),
##   `1985` = col_logical(),
##   `1986` = col_logical(),
##   `1987` = col_logical(),
##   `1988` = col_logical(),
##   `1989` = col_logical(),
##   `2014` = col_logical(),
##   `2015` = col_logical(),
##   `2016` = col_logical(),
##   `2017` = col_logical(),
##   `2018` = col_logical()
## )
## i Use `spec()` for the full column specifications.</code></pre>
<pre><code>## Warning: 1 parsing failure.
## row col   expected    actual                                                                     file
##  55  -- 41 columns 1 columns &#39;C:/Users/mteunis/workspaces/staRters/data/CISID_pertussis_10082018.csv&#39;</code></pre>
</div>
<div id="inspect-data" class="section level3 unnumbered" number="">
<h3>Inspect data</h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="wrangling.html#cb7-1"></a>pertussis_data</span></code></pre></div>
<pre><code>## # A tibble: 55 x 41
##       X1 X2    `1980` `1981` `1982` `1983` `1984` `1985` `1986` `1987` `1988`
##    &lt;dbl&gt; &lt;chr&gt; &lt;lgl&gt;  &lt;lgl&gt;  &lt;lgl&gt;  &lt;lgl&gt;  &lt;lgl&gt;  &lt;lgl&gt;  &lt;lgl&gt;  &lt;lgl&gt;  &lt;lgl&gt; 
##  1     2 Alba~ NA     NA     NA     NA     NA     NA     NA     NA     NA    
##  2     5 Ando~ NA     NA     NA     NA     NA     NA     NA     NA     NA    
##  3    10 Arme~ NA     NA     NA     NA     NA     NA     NA     NA     NA    
##  4    13 Aust~ NA     NA     NA     NA     NA     NA     NA     NA     NA    
##  5    14 Azer~ NA     NA     NA     NA     NA     NA     NA     NA     NA    
##  6    19 Bela~ NA     NA     NA     NA     NA     NA     NA     NA     NA    
##  7    20 Belg~ NA     NA     NA     NA     NA     NA     NA     NA     NA    
##  8    26 Bosn~ NA     NA     NA     NA     NA     NA     NA     NA     NA    
##  9    31 Bulg~ NA     NA     NA     NA     NA     NA     NA     NA     NA    
## 10    51 Croa~ NA     NA     NA     NA     NA     NA     NA     NA     NA    
## # ... with 45 more rows, and 30 more variables: `1989` &lt;lgl&gt;, `1990` &lt;dbl&gt;,
## #   `1991` &lt;dbl&gt;, `1992` &lt;dbl&gt;, `1993` &lt;dbl&gt;, `1994` &lt;dbl&gt;, `1995` &lt;dbl&gt;,
## #   `1996` &lt;dbl&gt;, `1997` &lt;dbl&gt;, `1998` &lt;dbl&gt;, `1999` &lt;dbl&gt;, `2000` &lt;dbl&gt;,
## #   `2001` &lt;dbl&gt;, `2002` &lt;dbl&gt;, `2003` &lt;dbl&gt;, `2004` &lt;dbl&gt;, `2005` &lt;dbl&gt;,
## #   `2006` &lt;dbl&gt;, `2007` &lt;dbl&gt;, `2008` &lt;dbl&gt;, `2009` &lt;dbl&gt;, `2010` &lt;dbl&gt;,
## #   `2011` &lt;dbl&gt;, `2012` &lt;dbl&gt;, `2013` &lt;dbl&gt;, `2014` &lt;lgl&gt;, `2015` &lt;lgl&gt;,
## #   `2016` &lt;lgl&gt;, `2017` &lt;lgl&gt;, `2018` &lt;lgl&gt;</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="wrangling.html#cb9-1"></a><span class="kw">names</span>(pertussis_data)</span></code></pre></div>
<pre><code>##  [1] &quot;X1&quot;   &quot;X2&quot;   &quot;1980&quot; &quot;1981&quot; &quot;1982&quot; &quot;1983&quot; &quot;1984&quot; &quot;1985&quot; &quot;1986&quot; &quot;1987&quot;
## [11] &quot;1988&quot; &quot;1989&quot; &quot;1990&quot; &quot;1991&quot; &quot;1992&quot; &quot;1993&quot; &quot;1994&quot; &quot;1995&quot; &quot;1996&quot; &quot;1997&quot;
## [21] &quot;1998&quot; &quot;1999&quot; &quot;2000&quot; &quot;2001&quot; &quot;2002&quot; &quot;2003&quot; &quot;2004&quot; &quot;2005&quot; &quot;2006&quot; &quot;2007&quot;
## [31] &quot;2008&quot; &quot;2009&quot; &quot;2010&quot; &quot;2011&quot; &quot;2012&quot; &quot;2013&quot; &quot;2014&quot; &quot;2015&quot; &quot;2016&quot; &quot;2017&quot;
## [41] &quot;2018&quot;</code></pre>
</div>
<div id="prepare-the-data-with-tidyr-and-dplyr" class="section level3 unnumbered" number="">
<h3>Prepare the data with <code>{tidyr}</code> and <code>{dplyr}</code></h3>
<p>The data will be prepared for Exploratory Data Analysis using two core packages of the tidyverse. <code>{tidyr}</code> is for reshaping data, <code>{dplyr}</code> is for wrangling data.</p>
</div>
<div id="characteristics-of-the-pertussis-dataset" class="section level3 unnumbered" number="">
<h3>Characteristics of the pertussis dataset</h3>
<ul>
<li>The first few lines of the file have comments indicated with <code>#</code></li>
<li>There are 53 countries in the dataset</li>
<li>There is no data for the years 1980-1989 and 2014-2018</li>
<li>The data is not in <code>tidy</code> format</li>
<li>Missing values are indicated with <strong>empty cells</strong></li>
<li>It is not a good idea to have a column name starting with a digit; why?</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="wrangling.html#cb11-1"></a>pertussis_data</span></code></pre></div>
<pre><code>## # A tibble: 55 x 41
##       X1 X2    `1980` `1981` `1982` `1983` `1984` `1985` `1986` `1987` `1988`
##    &lt;dbl&gt; &lt;chr&gt; &lt;lgl&gt;  &lt;lgl&gt;  &lt;lgl&gt;  &lt;lgl&gt;  &lt;lgl&gt;  &lt;lgl&gt;  &lt;lgl&gt;  &lt;lgl&gt;  &lt;lgl&gt; 
##  1     2 Alba~ NA     NA     NA     NA     NA     NA     NA     NA     NA    
##  2     5 Ando~ NA     NA     NA     NA     NA     NA     NA     NA     NA    
##  3    10 Arme~ NA     NA     NA     NA     NA     NA     NA     NA     NA    
##  4    13 Aust~ NA     NA     NA     NA     NA     NA     NA     NA     NA    
##  5    14 Azer~ NA     NA     NA     NA     NA     NA     NA     NA     NA    
##  6    19 Bela~ NA     NA     NA     NA     NA     NA     NA     NA     NA    
##  7    20 Belg~ NA     NA     NA     NA     NA     NA     NA     NA     NA    
##  8    26 Bosn~ NA     NA     NA     NA     NA     NA     NA     NA     NA    
##  9    31 Bulg~ NA     NA     NA     NA     NA     NA     NA     NA     NA    
## 10    51 Croa~ NA     NA     NA     NA     NA     NA     NA     NA     NA    
## # ... with 45 more rows, and 30 more variables: `1989` &lt;lgl&gt;, `1990` &lt;dbl&gt;,
## #   `1991` &lt;dbl&gt;, `1992` &lt;dbl&gt;, `1993` &lt;dbl&gt;, `1994` &lt;dbl&gt;, `1995` &lt;dbl&gt;,
## #   `1996` &lt;dbl&gt;, `1997` &lt;dbl&gt;, `1998` &lt;dbl&gt;, `1999` &lt;dbl&gt;, `2000` &lt;dbl&gt;,
## #   `2001` &lt;dbl&gt;, `2002` &lt;dbl&gt;, `2003` &lt;dbl&gt;, `2004` &lt;dbl&gt;, `2005` &lt;dbl&gt;,
## #   `2006` &lt;dbl&gt;, `2007` &lt;dbl&gt;, `2008` &lt;dbl&gt;, `2009` &lt;dbl&gt;, `2010` &lt;dbl&gt;,
## #   `2011` &lt;dbl&gt;, `2012` &lt;dbl&gt;, `2013` &lt;dbl&gt;, `2014` &lt;lgl&gt;, `2015` &lt;lgl&gt;,
## #   `2016` &lt;lgl&gt;, `2017` &lt;lgl&gt;, `2018` &lt;lgl&gt;</code></pre>
<p><strong>Discuss the output with you neighbour</strong></p>
<p>Try solving the questions:</p>
<ul>
<li>Are the rows observations?</li>
<li>Are the columns variables?</li>
<li>Is there a single value in each cell?</li>
</ul>
</div>
</div>
<div id="tidy-data" class="section level2" number="10.4">
<h2><span class="header-section-number">10.4</span> Tidy data</h2>
<p>To tidy the pertussis data we need to <code>gather</code> the <code>year</code> columns. We create a long formatted dataframe containing all the years in one column, all the <code>annual_pertussis_cases</code> in another, and all the countries in a seperate column. Each combination will be repated over the new columns automatically.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="wrangling.html#cb13-1"></a><span class="co">## try the code below, why does it fail?</span></span>
<span id="cb13-2"><a href="wrangling.html#cb13-2"></a>pertussis_data_tidy &lt;-<span class="st"> </span>pertussis_data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-3"><a href="wrangling.html#cb13-3"></a><span class="st">  </span><span class="kw">gather</span>(<span class="dv">1980</span><span class="op">:</span><span class="dv">2018</span>, <span class="dt">key =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;annual_pertussis_cases&quot;</span>)</span></code></pre></div>
<p>To reference names that contain ‘digits’ or other ‘special characters’</p>
<p><code>`</code></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="wrangling.html#cb14-1"></a>pertussis_data_tidy &lt;-<span class="st"> </span>pertussis_data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-2"><a href="wrangling.html#cb14-2"></a><span class="st">  </span><span class="kw">gather</span>(<span class="st">`</span><span class="dt">1980</span><span class="st">`</span><span class="op">:</span><span class="st">`</span><span class="dt">2018</span><span class="st">`</span>, <span class="dt">key =</span> <span class="st">&quot;year&quot;</span>, </span>
<span id="cb14-3"><a href="wrangling.html#cb14-3"></a>                        <span class="dt">value =</span> <span class="st">&quot;annual_pertussis_cases&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb14-4"><a href="wrangling.html#cb14-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">annual_pertussis_cases =</span> <span class="kw">as.numeric</span>(annual_pertussis_cases</span>
<span id="cb14-5"><a href="wrangling.html#cb14-5"></a>                                             ))</span>
<span id="cb14-6"><a href="wrangling.html#cb14-6"></a>pertussis_data_tidy</span></code></pre></div>
<pre><code>## # A tibble: 2,145 x 4
##       X1 X2                     year  annual_pertussis_cases
##    &lt;dbl&gt; &lt;chr&gt;                  &lt;chr&gt;                  &lt;dbl&gt;
##  1     2 Albania                1980                      NA
##  2     5 Andorra                1980                      NA
##  3    10 Armenia                1980                      NA
##  4    13 Austria                1980                      NA
##  5    14 Azerbaijan             1980                      NA
##  6    19 Belarus                1980                      NA
##  7    20 Belgium                1980                      NA
##  8    26 Bosnia and Herzegovina 1980                      NA
##  9    31 Bulgaria               1980                      NA
## 10    51 Croatia                1980                      NA
## # ... with 2,135 more rows</code></pre>
</div>
<div id="the-pipe-or" class="section level2" number="10.5">
<h2><span class="header-section-number">10.5</span> The pipe or “%&gt;%”</h2>
<p><img src="images/pipe.png" width="348" style="display: block; margin: auto 0 auto auto;" /></p>
<div id="pipes" class="section level3 unnumbered" number="">
<h3>Pipes</h3>
<ul>
<li>The pipe, <code>%&gt;%</code>, comes from the <strong>magrittr</strong> package by Stefan Milton Bache</li>
<li>Load it explicitly:</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="wrangling.html#cb16-1"></a><span class="kw">library</span>(magrittr)</span></code></pre></div>
</div>
<div id="using-the-pipe" class="section level3 unnumbered" number="">
<h3>Using the pipe (<code>%&gt;%</code>)</h3>
<p>No pipe:</p>
<p><code>variable_new &lt;- do_something(variable_old)</code></p>
<p>Pipe:</p>
<p><code>variable_new &lt;- variable_old %&gt;%    do_something(.)</code></p>
<p>or the same:</p>
<p><code>variable_new &lt;- variable_old %&gt;%    do_something()</code></p>
<p>The <code>.</code> (dot) is a placeholder for the ‘old’ variable. If you need to explicitely refer to something inside <code>variable_old</code> e.g. a column in dataframe you can use <code>.$colum_name</code></p>
</div>
</div>
<div id="the-dplyr-package-in-detail" class="section level2" number="10.6">
<h2><span class="header-section-number">10.6</span> The <code>{dplyr}</code> package in detail</h2>
<p><em>Subsetting, filtering, selecting, summarizing, sorting data(frames)</em></p>
<div id="the-dplyr-package" class="section level3 unnumbered" number="">
<h3>the {dplyr} package</h3>
<p>The dplyr package makes these steps fast and easy:</p>
<ul>
<li>dplyr simplifies how you can think about common data manipulation tasks.</li>
<li>Simple “verbs”, functions that correspond to the most common data manipulation tasks, to help you translate those thoughts into code.</li>
<li>It uses efficient data storage backends, so you spend less time waiting for the computer.</li>
</ul>
</div>
<div id="data-bases-can-be-connected-to-dplyr" class="section level3 unnumbered" number="">
<h3>Data bases can be connected to dplyr</h3>
<ul>
<li>Besides in-memory data frames</li>
<li>{dplyr} also connects to out-of-memory, remote databases.</li>
<li>By translating your R code into the appropriate SQL</li>
<li>Allows you to work with both types of data using the same set of tools.</li>
</ul>
<p><strong>dplyr can work with data frames as is, but if you’re dealing with large data, it’s worthwhile to convert them to a <code>tbl_df</code>: this is a wrapper around a data frame that won’t accidentally print a lot of data to the screen.</strong></p>
</div>
<div id="verbs" class="section level3 unnumbered" number="">
<h3>Verbs</h3>
<p><code>{dplyr}</code> aims to provide a function for each basic verb of data manipulation:</p>
<ul>
<li><code>select()</code> (and <code>rename()</code>)</li>
<li><code>left_join()</code> (<code>full_join()</code>, <code>anti_join()</code>, <code>right_join()</code>)</li>
<li><code>filter()</code> (and <code>slice()</code>)</li>
<li><code>arrange()</code></li>
<li><code>distinct()</code></li>
<li><code>mutate()</code> (and <code>transmute()</code>)</li>
<li><code>summarise()</code></li>
<li><code>sample_n()</code> (and <code>sample_frac()</code>)</li>
</ul>
<div id="dplyrrename-dplyrselect" class="section level4 unnumbered" number="">
<h4><code>dplyr::rename()</code> &amp; <code>dplyr::select()</code></h4>
<p>For Renaming variables (<code>rename()</code>)</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="wrangling.html#cb17-1"></a><span class="kw">names</span>(pertussis_data_tidy)</span></code></pre></div>
<pre><code>## [1] &quot;X1&quot;                     &quot;X2&quot;                     &quot;year&quot;                  
## [4] &quot;annual_pertussis_cases&quot;</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="wrangling.html#cb19-1"></a><span class="co">## we can `rename()` a variable and `select()` variables</span></span>
<span id="cb19-2"><a href="wrangling.html#cb19-2"></a>pertussis_data_tidy &lt;-<span class="st"> </span>pertussis_data_tidy <span class="op">%&gt;%</span></span>
<span id="cb19-3"><a href="wrangling.html#cb19-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">rename</span>(<span class="dt">some_strange_index =</span> X1,</span>
<span id="cb19-4"><a href="wrangling.html#cb19-4"></a>       <span class="dt">country =</span> X2)</span>
<span id="cb19-5"><a href="wrangling.html#cb19-5"></a></span>
<span id="cb19-6"><a href="wrangling.html#cb19-6"></a>pertussis_data_tidy <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 4
##   some_strange_index country year  annual_pertussis_cases
##                &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;                  &lt;dbl&gt;
## 1                  2 Albania 1980                      NA
## 2                  5 Andorra 1980                      NA</code></pre>
<p>Dropping the column "some_strange_index (<code>select()</code>)</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="wrangling.html#cb21-1"></a>pertussis_data_tidy &lt;-<span class="st"> </span>pertussis_data_tidy <span class="op">%&gt;%</span></span>
<span id="cb21-2"><a href="wrangling.html#cb21-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(country,</span>
<span id="cb21-3"><a href="wrangling.html#cb21-3"></a>          year,</span>
<span id="cb21-4"><a href="wrangling.html#cb21-4"></a>          annual_pertussis_cases)</span>
<span id="cb21-5"><a href="wrangling.html#cb21-5"></a></span>
<span id="cb21-6"><a href="wrangling.html#cb21-6"></a>pertussis_data_tidy <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   country year  annual_pertussis_cases
##   &lt;chr&gt;   &lt;chr&gt;                  &lt;dbl&gt;
## 1 Albania 1980                      NA
## 2 Andorra 1980                      NA</code></pre>
<p>Using <code>-</code> to drop specific column(s) will also work</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="wrangling.html#cb23-1"></a>only_cases &lt;-<span class="st"> </span>pertussis_data_tidy <span class="op">%&gt;%</span></span>
<span id="cb23-2"><a href="wrangling.html#cb23-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(country, year))</span>
<span id="cb23-3"><a href="wrangling.html#cb23-3"></a></span>
<span id="cb23-4"><a href="wrangling.html#cb23-4"></a>pertussis_data_tidy <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>(<span class="dv">2</span>)</span>
<span id="cb23-5"><a href="wrangling.html#cb23-5"></a></span>
<span id="cb23-6"><a href="wrangling.html#cb23-6"></a></span>
<span id="cb23-7"><a href="wrangling.html#cb23-7"></a></span>
<span id="cb23-8"><a href="wrangling.html#cb23-8"></a></span>
<span id="cb23-9"><a href="wrangling.html#cb23-9"></a></span>
<span id="cb23-10"><a href="wrangling.html#cb23-10"></a><span class="co">## When selecting multiple columns, construct a vector with `c()`</span></span>
<span id="cb23-11"><a href="wrangling.html#cb23-11"></a><span class="co">## like select(-c(columns_1, columns_2, column_3))</span></span></code></pre></div>
</div>
<div id="intermezzo-creating-a-joined-table" class="section level4 unnumbered" number="">
<h4>– INTERMEZZO – Creating a joined table</h4>
<p>Before we start playing with the other <code>{dplyr}</code> verbs I would like for you to have a more complex dataset to practice with. Here we create one joining the <code>gapminder</code> and our <code>pertussis</code> data.</p>
</div>
</div>
</div>
<div id="join-pertussis-with-gapminder-data" class="section level2" number="10.7">
<h2><span class="header-section-number">10.7</span> Join pertussis with gapminder data</h2>
<p>Here we join the pertussis data with the <code>gapminder</code> data though an <code>inner_join()</code>. <code>{dplyr}</code> has many join function, which we will not go into detail here. For more information and a tutorial see:
<a href="http://stat545.com/bit001_dplyr-cheatsheet.html" class="uri">http://stat545.com/bit001_dplyr-cheatsheet.html</a></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="wrangling.html#cb24-1"></a><span class="kw">data</span>(<span class="st">&quot;gapminder&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;dslabs&quot;</span>)</span>
<span id="cb24-2"><a href="wrangling.html#cb24-2"></a>gapminder &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>()</span></code></pre></div>
<div id="using-inner_join-from-dplyr" class="section level4 unnumbered" number="">
<h4>Using <code>inner_join()</code> from <code>{dplyr}</code></h4>
<p>When joining tables you need at least one shared variable, that has the same name in all tables you want to join. We call this variable (or variables) the (primary) <code>key</code>s. Here we use <code>country</code> and <code>year</code> as key to join only those observations that are fully shared for both <code>key</code>s in both datasets (<code>inner_join</code>)</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="wrangling.html#cb25-1"></a><span class="co"># pertussis_data_tidy</span></span>
<span id="cb25-2"><a href="wrangling.html#cb25-2"></a><span class="co"># gapminder</span></span>
<span id="cb25-3"><a href="wrangling.html#cb25-3"></a>gapminder<span class="op">$</span>year &lt;-<span class="st"> </span><span class="kw">as.character</span>(gapminder<span class="op">$</span>year)</span>
<span id="cb25-4"><a href="wrangling.html#cb25-4"></a></span>
<span id="cb25-5"><a href="wrangling.html#cb25-5"></a>join &lt;-<span class="st">   </span>dplyr<span class="op">::</span><span class="kw">inner_join</span> (gapminder, pertussis_data_tidy, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;country&quot;</span>, <span class="st">&quot;year&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb25-6"><a href="wrangling.html#cb25-6"></a><span class="st">  </span><span class="kw">na.omit</span>()</span>
<span id="cb25-7"><a href="wrangling.html#cb25-7"></a>join</span></code></pre></div>
<pre><code>## # A tibble: 861 x 10
##    country year  infant_mortality life_expectancy fertility population     gdp
##    &lt;chr&gt;   &lt;chr&gt;            &lt;dbl&gt;           &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;
##  1 Albania 1990              35.1            73.3      2.97    3281453 3.22e 9
##  2 Armenia 1990              42.5            70.1      2.54    3544695 2.82e 9
##  3 Austria 1990               8              75.7      1.46    7706571 1.47e11
##  4 Azerba~ 1990              75.5            65.6      2.97    7216503 8.95e 9
##  5 Belarus 1990              13.5            70.5      1.89   10231983 1.44e10
##  6 Belgium 1990               8.3            76        1.58    9978241 1.87e11
##  7 Bulgar~ 1990              18.4            71.4      1.77    8821111 1.46e10
##  8 Croatia 1990              11.2            72.6      1.67    4776374 2.51e10
##  9 Cyprus  1990               9.9            76.8      2.41     766611 6.19e 9
## 10 Czech ~ 1990              12.7            71.8      1.82   10323701 5.63e10
## # ... with 851 more rows, and 3 more variables: continent &lt;fct&gt;, region &lt;fct&gt;,
## #   annual_pertussis_cases &lt;dbl&gt;</code></pre>
<p><em>Now we are ready to start exploring and manipulating this dataset and maybe create some visualizations as we go along!</em></p>
</div>
<div id="dplyrfilter" class="section level4 unnumbered" number="">
<h4><code>dplyr::filter()</code></h4>
<p>Subsetting data with <code>filter()</code>. Filter all data for the country ‘The Netherlands’</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="wrangling.html#cb27-1"></a><span class="co"># join$year %&gt;% as_factor %&gt;% levels()</span></span>
<span id="cb27-2"><a href="wrangling.html#cb27-2"></a><span class="co"># join$country %&gt;% as_factor() %&gt;% levels()</span></span>
<span id="cb27-3"><a href="wrangling.html#cb27-3"></a>netherlands &lt;-<span class="st"> </span>join <span class="op">%&gt;%</span></span>
<span id="cb27-4"><a href="wrangling.html#cb27-4"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;Netherlands&quot;</span>)</span>
<span id="cb27-5"><a href="wrangling.html#cb27-5"></a>netherlands</span></code></pre></div>
<pre><code>## # A tibble: 20 x 10
##    country year  infant_mortality life_expectancy fertility population     gdp
##    &lt;chr&gt;   &lt;chr&gt;            &lt;dbl&gt;           &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;
##  1 Nether~ 1990               6.8            77        1.62   14915139 2.82e11
##  2 Nether~ 1991               6.5            77.2      1.61   15019184 2.89e11
##  3 Nether~ 1992               6.3            77.3      1.59   15128288 2.94e11
##  4 Nether~ 1993               6.1            77.2      1.57   15239262 2.97e11
##  5 Nether~ 1994               5.8            77.5      1.57   15347792 3.06e11
##  6 Nether~ 1995               5.7            77.6      1.53   15450803 3.16e11
##  7 Nether~ 1996               5.5            77.6      1.53   15546647 3.27e11
##  8 Nether~ 1997               5.3            77.9      1.56   15636131 3.41e11
##  9 Nether~ 1998               5.3            78.1      1.63   15721627 3.54e11
## 10 Nether~ 1999               5.2            78        1.65   15806771 3.70e11
## 11 Nether~ 2000               5.1            78.1      1.72   15894016 3.85e11
## 12 Nether~ 2001               5              78.3      1.71   15984365 3.92e11
## 13 Nether~ 2002               4.9            78.5      1.73   16076427 3.93e11
## 14 Nether~ 2004               4.6            79.1      1.73   16253397 4.03e11
## 15 Nether~ 2005               4.5            79.6      1.71   16331646 4.11e11
## 16 Nether~ 2006               4.3            79.9      1.72   16401105 4.25e11
## 17 Nether~ 2007               4.2            80.2      1.72   16463031 4.42e11
## 18 Nether~ 2008               4              80.3      1.77   16519862 4.50e11
## 19 Nether~ 2009               3.8            80.6      1.79   16575173 4.34e11
## 20 Nether~ 2011               3.6            80.9      1.76   16689863 4.46e11
## # ... with 3 more variables: continent &lt;fct&gt;, region &lt;fct&gt;,
## #   annual_pertussis_cases &lt;dbl&gt;</code></pre>
</div>
<div id="booleans" class="section level4 unnumbered" number="">
<h4>Booleans</h4>
<p>Boolans such as <code>AND</code>, <code>OR</code> and <code>NOT</code> can be used to call multiple filter argument. You need to be explicit if you use them:</p>
<p>Using booleans with <code>filter()</code></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="wrangling.html#cb29-1"></a><span class="co">#join$year %&gt;% as_factor %&gt;% levels()</span></span>
<span id="cb29-2"><a href="wrangling.html#cb29-2"></a><span class="co">#join$country %&gt;% as_factor() %&gt;% levels()</span></span>
<span id="cb29-3"><a href="wrangling.html#cb29-3"></a></span>
<span id="cb29-4"><a href="wrangling.html#cb29-4"></a>booleans_demo &lt;-<span class="st"> </span>join <span class="op">%&gt;%</span></span>
<span id="cb29-5"><a href="wrangling.html#cb29-5"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;Netherlands&quot;</span> <span class="op">|</span></span>
<span id="cb29-6"><a href="wrangling.html#cb29-6"></a><span class="st">         </span>country <span class="op">==</span><span class="st"> &quot;Belarus&quot;</span> <span class="op">&amp;</span></span>
<span id="cb29-7"><a href="wrangling.html#cb29-7"></a><span class="st">         </span>year <span class="op">==</span><span class="st"> &quot;1990&quot;</span> <span class="op">|</span><span class="st">                 </span><span class="co">## | is OR in R</span></span>
<span id="cb29-8"><a href="wrangling.html#cb29-8"></a><span class="st">         </span>year <span class="op">==</span><span class="st"> &quot;1995&quot;</span> <span class="op">&amp;</span><span class="st">                 </span><span class="co">## &amp; is AND in R   </span></span>
<span id="cb29-9"><a href="wrangling.html#cb29-9"></a><span class="st">         </span><span class="op">!</span>annual_pertussis_cases <span class="op">&lt;</span><span class="st"> </span><span class="dv">100</span>)   <span class="co">## ! is NOT in R (not smaller                                                             than 100)</span></span>
<span id="cb29-10"><a href="wrangling.html#cb29-10"></a>booleans_demo</span></code></pre></div>
<pre><code>## # A tibble: 40 x 10
##    country year  infant_mortality life_expectancy fertility population     gdp
##    &lt;chr&gt;   &lt;chr&gt;            &lt;dbl&gt;           &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;
##  1 Belarus 1990              13.5            70.5      1.89   10231983 1.44e10
##  2 Nether~ 1990               6.8            77        1.62   14915139 2.82e11
##  3 Nether~ 1991               6.5            77.2      1.61   15019184 2.89e11
##  4 Nether~ 1992               6.3            77.3      1.59   15128288 2.94e11
##  5 Nether~ 1993               6.1            77.2      1.57   15239262 2.97e11
##  6 Nether~ 1994               5.8            77.5      1.57   15347792 3.06e11
##  7 Albania 1995              29.1            73.7      2.72    3106727 2.83e 9
##  8 Belarus 1995              14.4            68.2      1.47   10159731 9.38e 9
##  9 Bosnia~ 1995              12.3            67        1.53    3879278 1.62e 9
## 10 Croatia 1995               8.7            73        1.52    4616762 1.82e10
## # ... with 30 more rows, and 3 more variables: continent &lt;fct&gt;, region &lt;fct&gt;,
## #   annual_pertussis_cases &lt;dbl&gt;</code></pre>
<p>Conditional filtering. Conditions such as:</p>
<ul>
<li><code>&gt;</code> or <code>&gt;=</code> (larger than, or larger or eual to),</li>
<li><code>&lt;</code> or <code>&lt;=</code> (smaller than, or smaller or equal to)</li>
<li><code>==</code> (equal to)</li>
<li><code>!=</code> (not qual to)</li>
</ul>
<p>Can be built into a <code>filter()</code> or <code>select()</code> call as we have seen above.
Let’s apply this to our dataset in more detail. To match multiple filter statements you can use</p>
<p><code>%in%</code></p>
<p>This shorthand is synonym for <code>match()</code> and takes a vector of values and a table (variable names in our case).</p>
<p>Look at <code>?%in%</code> for more detail amd help</p>
</div>
<div id="example-for-using-in-match" class="section level4 unnumbered" number="">
<h4>Example for using <code>%in%</code> (match)</h4>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="wrangling.html#cb31-1"></a>numbers &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb31-2"><a href="wrangling.html#cb31-2"></a>  <span class="op">~</span>number_<span class="dv">1</span>, <span class="op">~</span>number_<span class="dv">2</span>,</span>
<span id="cb31-3"><a href="wrangling.html#cb31-3"></a>  <span class="dv">1</span>,          <span class="dv">2</span>,</span>
<span id="cb31-4"><a href="wrangling.html#cb31-4"></a>  <span class="dv">3</span>,          <span class="dv">4</span>,</span>
<span id="cb31-5"><a href="wrangling.html#cb31-5"></a>  <span class="dv">5</span>,          <span class="dv">6</span></span>
<span id="cb31-6"><a href="wrangling.html#cb31-6"></a>)  </span>
<span id="cb31-7"><a href="wrangling.html#cb31-7"></a></span>
<span id="cb31-8"><a href="wrangling.html#cb31-8"></a>match_vector &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)</span>
<span id="cb31-9"><a href="wrangling.html#cb31-9"></a></span>
<span id="cb31-10"><a href="wrangling.html#cb31-10"></a><span class="co">## </span></span>
<span id="cb31-11"><a href="wrangling.html#cb31-11"></a>numbers <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">filter</span>(<span class="op">!</span>number_<span class="dv">1</span> <span class="op">%in%</span><span class="st"> </span>match_vector)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   number_1 number_2
##      &lt;dbl&gt;    &lt;dbl&gt;
## 1        5        6</code></pre>
<p>Generalized <code>%in%</code> looks like</p>
<pre><code>values_you_want_to_match_against (variable name) %in% values_to_match (vector)</code></pre>
<p><strong>Discuss with you neighbour</strong>
Write a filter statement using the <code>join</code> data that:</p>
<ul>
<li>filters only those countries that have more than 3000 annual cases for pertussis infection.</li>
<li>Use only data between year 1990 and 2010</li>
<li>The resulting table must only contain the variables <code>year</code>, <code>country</code> and <code>annual_pertussis_cases</code> in that order</li>
<li>Create a plot that shows that your code has worked</li>
</ul>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="wrangling.html#cb34-1"></a><span class="co">## first define the values to match against</span></span>
<span id="cb34-2"><a href="wrangling.html#cb34-2"></a>years &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1990</span><span class="op">:</span><span class="dv">2010</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.character</span>()</span>
<span id="cb34-3"><a href="wrangling.html#cb34-3"></a><span class="co">## than do the filtering using %in%</span></span>
<span id="cb34-4"><a href="wrangling.html#cb34-4"></a>join_filtered &lt;-<span class="st"> </span>join <span class="op">%&gt;%</span></span>
<span id="cb34-5"><a href="wrangling.html#cb34-5"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(annual_pertussis_cases <span class="op">&gt;</span><span class="st"> </span><span class="dv">3000</span> <span class="op">&amp;</span></span>
<span id="cb34-6"><a href="wrangling.html#cb34-6"></a><span class="st">         </span>year <span class="op">%in%</span><span class="st"> </span>years) <span class="op">%&gt;%</span></span>
<span id="cb34-7"><a href="wrangling.html#cb34-7"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(year,</span>
<span id="cb34-8"><a href="wrangling.html#cb34-8"></a>         country,</span>
<span id="cb34-9"><a href="wrangling.html#cb34-9"></a>         annual_pertussis_cases)</span>
<span id="cb34-10"><a href="wrangling.html#cb34-10"></a></span>
<span id="cb34-11"><a href="wrangling.html#cb34-11"></a>join_filtered <span class="op">%&gt;%</span></span>
<span id="cb34-12"><a href="wrangling.html#cb34-12"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year,</span>
<span id="cb34-13"><a href="wrangling.html#cb34-13"></a>             <span class="dt">y =</span> annual_pertussis_cases)) <span class="op">+</span></span>
<span id="cb34-14"><a href="wrangling.html#cb34-14"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> country)) <span class="op">+</span></span>
<span id="cb34-15"><a href="wrangling.html#cb34-15"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> country, <span class="dt">colour =</span> country)) <span class="op">+</span></span>
<span id="cb34-16"><a href="wrangling.html#cb34-16"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">-90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>))</span></code></pre></div>
<p><img src="ch08-wrangling_files/figure-html/using_match,%20options_exercises-1.png" width="672" /></p>
</div>
<div id="dplyrarrange" class="section level4 unnumbered" number="">
<h4><code>dplyr::arrange()</code></h4>
<p>Sorting data with <code>arrange()</code></p>
<ul>
<li>Sort(rank) your data ascending or descending<br />
</li>
<li><code>{dplyr}</code> verb to use is <code>arrange()</code>,</li>
<li>In conjunction with the <code>desc()</code> function if you want to rank in descending order</li>
<li><code>arrange()</code> takes one or multiple variable names for which you want to sort</li>
</ul>
</div>
<div id="example-arrange" class="section level4 unnumbered" number="">
<h4>Example <code>arrange()</code></h4>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="wrangling.html#cb35-1"></a><span class="co">## ascending</span></span>
<span id="cb35-2"><a href="wrangling.html#cb35-2"></a>join_filtered <span class="op">%&gt;%</span></span>
<span id="cb35-3"><a href="wrangling.html#cb35-3"></a><span class="st">  </span><span class="kw">arrange</span>(annual_pertussis_cases)</span></code></pre></div>
<pre><code>## # A tibble: 61 x 3
##    year  country annual_pertussis_cases
##    &lt;chr&gt; &lt;chr&gt;                    &lt;dbl&gt;
##  1 2002  Norway                    3170
##  2 1992  Ukraine                   3363
##  3 1997  Italy                     3364
##  4 1994  Ukraine                   3374
##  5 2000  Norway                    3417
##  6 2010  Norway                    3565
##  7 1996  Spain                     3577
##  8 1998  Italy                     3632
##  9 1995  Spain                     3741
## 10 1999  Italy                     3797
## # ... with 51 more rows</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="wrangling.html#cb37-1"></a><span class="co">## descending</span></span>
<span id="cb37-2"><a href="wrangling.html#cb37-2"></a>join_filtered <span class="op">%&gt;%</span></span>
<span id="cb37-3"><a href="wrangling.html#cb37-3"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(annual_pertussis_cases))</span></code></pre></div>
<pre><code>## # A tibble: 61 x 3
##    year  country     annual_pertussis_cases
##    &lt;chr&gt; &lt;chr&gt;                        &lt;dbl&gt;
##  1 1994  Switzerland                  26000
##  2 1995  Switzerland                  20000
##  3 1991  Italy                        19356
##  4 1990  Italy                        16992
##  5 1995  Italy                        14359
##  6 1994  Italy                        13360
##  7 1994  Sweden                       13187
##  8 1997  Switzerland                  13000
##  9 1998  Switzerland                  13000
## 10 1993  Sweden                       11542
## # ... with 51 more rows</code></pre>
<p>Apparently the worst <code>pertussis</code> year was 1994 in Switzerland?</p>
</div>
<div id="dplyrmutate" class="section level4 unnumbered" number="">
<h4><code>dplyr::mutate()</code></h4>
<p>Changing variables on the basis of a computation (<code>mutate()</code>)
Sometimes you want to change a variable by mutation e.g.:</p>
<ul>
<li>Change type of the variable</li>
<li>Compute a new variable using two exisiting ones</li>
<li>Do a mathmatical transformation (e.g. <code>log10()</code> of <code>log2()</code>)</li>
<li>… something else that mutates a variable</li>
</ul>
<p>You can do two things:</p>
<ol style="list-style-type: decimal">
<li>Overwrite an existing variable with the newly mutated one</li>
<li>Add a newly mutated variable to the existing data</li>
</ol>
</div>
<div id="example-mutate" class="section level4 unnumbered" number="">
<h4>Example <code>mutate()</code></h4>
<p>The annual pertussis cases is reported as an absolulte number per year. Using the population size from the <code>gapminder</code> dataset, we can calculate the number of pertussis cases per 100.000 people in a country with <code>mutate()</code></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="wrangling.html#cb39-1"></a>join_new &lt;-<span class="st"> </span>join <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb39-2"><a href="wrangling.html#cb39-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">incidence =</span> </span>
<span id="cb39-3"><a href="wrangling.html#cb39-3"></a>                  (annual_pertussis_cases<span class="op">/</span>population)<span class="op">*</span><span class="dv">100000</span>) <span class="op">%&gt;%</span></span>
<span id="cb39-4"><a href="wrangling.html#cb39-4"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(incidence, </span>
<span id="cb39-5"><a href="wrangling.html#cb39-5"></a>         annual_pertussis_cases, </span>
<span id="cb39-6"><a href="wrangling.html#cb39-6"></a>         country, year) <span class="op">%&gt;%</span></span>
<span id="cb39-7"><a href="wrangling.html#cb39-7"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(incidence))</span>
<span id="cb39-8"><a href="wrangling.html#cb39-8"></a>join_new </span></code></pre></div>
<pre><code>## # A tibble: 861 x 4
##    incidence annual_pertussis_cases country     year 
##        &lt;dbl&gt;                  &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;
##  1      374.                  26000 Switzerland 1994 
##  2      285.                  20000 Switzerland 1995 
##  3      183.                  13000 Switzerland 1997 
##  4      183.                  13000 Switzerland 1998 
##  5      169.                   7737 Norway      2004 
##  6      163.                  11500 Switzerland 1996 
##  7      154.                  11000 Switzerland 1999 
##  8      150.                  13187 Sweden      1994 
##  9      141.                   6587 Norway      2006 
## 10      133.                  11432 Sweden      1991 
## # ... with 851 more rows</code></pre>
<p>Plotting the cases/100.000</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="wrangling.html#cb41-1"></a>pop_size_corrected &lt;-<span class="st"> </span>join_new <span class="op">%&gt;%</span></span>
<span id="cb41-2"><a href="wrangling.html#cb41-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;Netherlands&quot;</span> <span class="op">|</span><span class="st"> </span>country <span class="op">==</span><span class="st"> &quot;Norway&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb41-3"><a href="wrangling.html#cb41-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, </span>
<span id="cb41-4"><a href="wrangling.html#cb41-4"></a>             <span class="dt">y =</span> incidence)) <span class="op">+</span></span>
<span id="cb41-5"><a href="wrangling.html#cb41-5"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> country, <span class="dt">colour =</span> country)) <span class="op">+</span></span>
<span id="cb41-6"><a href="wrangling.html#cb41-6"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">-90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>))</span></code></pre></div>
<p>Let’s see the difference between correcting for population size or not</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="wrangling.html#cb42-1"></a>pop_size_uncorrected &lt;-<span class="st"> </span>join <span class="op">%&gt;%</span></span>
<span id="cb42-2"><a href="wrangling.html#cb42-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;Netherlands&quot;</span> <span class="op">|</span><span class="st"> </span>country <span class="op">==</span><span class="st"> &quot;Norway&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb42-3"><a href="wrangling.html#cb42-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, </span>
<span id="cb42-4"><a href="wrangling.html#cb42-4"></a>             <span class="dt">y =</span> annual_pertussis_cases)) <span class="op">+</span></span>
<span id="cb42-5"><a href="wrangling.html#cb42-5"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> country, <span class="dt">colour =</span> country)) <span class="op">+</span></span>
<span id="cb42-6"><a href="wrangling.html#cb42-6"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">-90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>))</span></code></pre></div>
<p>Plotting two graphs in a panel</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="wrangling.html#cb43-1"></a>cowplot<span class="op">::</span><span class="kw">plot_grid</span>(pop_size_uncorrected,</span>
<span id="cb43-2"><a href="wrangling.html#cb43-2"></a>                   pop_size_corrected, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>))</span></code></pre></div>
<p><img src="ch08-wrangling_files/figure-html/unnamed-chunk-17-1.png" width="960" /></p>
<p><strong>Discuss with you neighbour</strong></p>
<p>Using <code>dplyr::mutate()</code></p>
<ul>
<li>Calculate the log10 of the population in a new variable called <code>log10_pop</code></li>
<li>Add this new variable to the <code>join</code> dataset<br />
</li>
<li>Create a plot using this new <code>log10_pop</code> variable</li>
</ul>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="wrangling.html#cb44-1"></a>join <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb44-2"><a href="wrangling.html#cb44-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">log10_pop =</span> <span class="kw">log10</span>(population)) <span class="op">%&gt;%</span></span>
<span id="cb44-3"><a href="wrangling.html#cb44-3"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> gdp,</span>
<span id="cb44-4"><a href="wrangling.html#cb44-4"></a>             <span class="dt">y =</span> log10_pop)) <span class="op">+</span></span>
<span id="cb44-5"><a href="wrangling.html#cb44-5"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> continent)) </span></code></pre></div>
<p><img src="ch08-wrangling_files/figure-html/correct_population,%20options_exercises-1.png" width="672" /></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="wrangling.html#cb45-1"></a><span class="co">#+</span></span>
<span id="cb45-2"><a href="wrangling.html#cb45-2"></a> <span class="co"># facet_wrap(~year)</span></span></code></pre></div>
</div>
<div id="summarize-data-with-dplyrsummarise" class="section level4 unnumbered" number="">
<h4>Summarize data with <code>dplyr::summarise()</code></h4>
<p>Summarizing data is an important step in Exploratory Data Analysis. Especially if you have high deminsional data, summarizing might lead you to interesting findings. It comes at a price howver, you also discard information, so beware!</p>
</div>
<div id="example-dplyrsummarise" class="section level4 unnumbered" number="">
<h4>Example <code>dplyr::summarise()</code></h4>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="wrangling.html#cb46-1"></a>summary_plot &lt;-<span class="st"> </span>join <span class="op">%&gt;%</span></span>
<span id="cb46-2"><a href="wrangling.html#cb46-2"></a><span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></span>
<span id="cb46-3"><a href="wrangling.html#cb46-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total_pertussis_cases =</span> <span class="kw">sum</span>(annual_pertussis_cases)) <span class="op">%&gt;%</span></span>
<span id="cb46-4"><a href="wrangling.html#cb46-4"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(<span class="kw">as_factor</span>(country), total_pertussis_cases),</span>
<span id="cb46-5"><a href="wrangling.html#cb46-5"></a>             <span class="dt">y =</span> total_pertussis_cases)) <span class="op">+</span></span>
<span id="cb46-6"><a href="wrangling.html#cb46-6"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb46-7"><a href="wrangling.html#cb46-7"></a><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></span>
<span id="cb46-8"><a href="wrangling.html#cb46-8"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Total pertussis cases from 1990 - 2013&quot;</span>) <span class="op">+</span></span>
<span id="cb46-9"><a href="wrangling.html#cb46-9"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Country&quot;</span>)</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="wrangling.html#cb48-1"></a>summary_plot</span></code></pre></div>
<p><img src="ch08-wrangling_files/figure-html/unnamed-chunk-18-1.png" width="768" /></p>
</div>
<div id="case-1-which-country-has-the-highest-total-number-of-pertussis-cases-over-the-years" class="section level3" number="10.7.1">
<h3><span class="header-section-number">10.7.1</span> Case 1; Which country has the highest total number of pertussis cases, over the years?</h3>
<p>Create a code chuk below that:</p>
<ul>
<li>Groups the data by <code>gdp</code>, <code>continent</code> and <code>year</code> (use the <code>gapminder</code> dataset)</li>
<li>Calculate the total population and the total gdp for each continent and each year</li>
<li>Plot the data in a graph that shows the relationship between year, continent, total gdp per continent and total population per continent.</li>
</ul>
<p><strong>TIP</strong> You might want to map population-size to the size of the datapoints</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="wrangling.html#cb49-1"></a><span class="co">## your answer goes here ---&gt;</span></span></code></pre></div>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="wrangling.html#cb50-1"></a>plot &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span></span>
<span id="cb50-2"><a href="wrangling.html#cb50-2"></a><span class="st">  </span><span class="kw">group_by</span>(year, continent) <span class="op">%&gt;%</span></span>
<span id="cb50-3"><a href="wrangling.html#cb50-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total_population =</span> <span class="kw">sum</span>(population),</span>
<span id="cb50-4"><a href="wrangling.html#cb50-4"></a>            <span class="dt">total_gdp =</span> <span class="kw">sum</span>(gdp), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb50-5"><a href="wrangling.html#cb50-5"></a><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year,</span>
<span id="cb50-6"><a href="wrangling.html#cb50-6"></a>               <span class="dt">y =</span> total_gdp)) <span class="op">+</span></span>
<span id="cb50-7"><a href="wrangling.html#cb50-7"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> continent, <span class="dt">size =</span> total_population)) <span class="op">+</span></span>
<span id="cb50-8"><a href="wrangling.html#cb50-8"></a><span class="st">  </span><span class="kw">coord_flip</span>()</span></code></pre></div>
<pre><code>## `summarise()` regrouping output by &#39;year&#39; (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="wrangling.html#cb52-1"></a>plot</span></code></pre></div>
<pre><code>## Warning: Removed 232 rows containing missing values (geom_point).</code></pre>
<p><img src="ch08-wrangling_files/figure-html/options_exercises-1.png" width="672" /></p>
</div>
<div id="case-2-is-there-a-relationship-between-infant-mortality-and-pertussis-cases" class="section level3" number="10.7.2">
<h3><span class="header-section-number">10.7.2</span> Case 2; Is there a relationship between infant mortality and pertussis cases?</h3>
<p><strong>Write a code chunk below:</strong></p>
<ul>
<li>Using <code>{ggplot2}</code></li>
<li>Plot <code>annual_pertussis_cases</code> againt <code>infant_mortality</code></li>
<li>Filter only for “Belarus” and “Netherlands”</li>
<li>Use all available data for these countries</li>
<li>Do not scroll ahead</li>
<li>What do you think is going on with this relationship?</li>
<li>Try using <code>colour = year</code> in your code</li>
<li>Try using <code>facet</code>s</li>
</ul>
</div>
</div>
<div id="one-possible-solution" class="section level2" number="10.8">
<h2><span class="header-section-number">10.8</span> <strong>ONE POSSIBLE SOLUTION</strong></h2>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="wrangling.html#cb54-1"></a><span class="kw">names</span>(join)</span></code></pre></div>
<pre><code>##  [1] &quot;country&quot;                &quot;year&quot;                   &quot;infant_mortality&quot;      
##  [4] &quot;life_expectancy&quot;        &quot;fertility&quot;              &quot;population&quot;            
##  [7] &quot;gdp&quot;                    &quot;continent&quot;              &quot;region&quot;                
## [10] &quot;annual_pertussis_cases&quot;</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="wrangling.html#cb56-1"></a>join <span class="op">%&gt;%</span></span>
<span id="cb56-2"><a href="wrangling.html#cb56-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(country <span class="op">==</span><span class="st"> &quot;Netherlands&quot;</span> <span class="op">|</span></span>
<span id="cb56-3"><a href="wrangling.html#cb56-3"></a><span class="st">         </span>country <span class="op">==</span><span class="st"> &quot;Belarus&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb56-4"><a href="wrangling.html#cb56-4"></a><span class="st">      </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> annual_pertussis_cases,</span>
<span id="cb56-5"><a href="wrangling.html#cb56-5"></a>               <span class="dt">y =</span> infant_mortality)) <span class="op">+</span></span>
<span id="cb56-6"><a href="wrangling.html#cb56-6"></a><span class="st">      </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> year)) <span class="op">+</span></span>
<span id="cb56-7"><a href="wrangling.html#cb56-7"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="op">+</span></span>
<span id="cb56-8"><a href="wrangling.html#cb56-8"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>country, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="ch08-wrangling_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
</div>
<div id="other-data-sources" class="section level2" number="10.9">
<h2><span class="header-section-number">10.9</span> Other data sources</h2>
<p>dplyr works with data that is stored in other ways, like data tables, databases and multidimensional arrays.</p>
<p>To see a tutorial: <a href="https://db.rstudio.com/dplyr/" class="uri">https://db.rstudio.com/dplyr/</a></p>
</div>
<div id="exercises" class="section level2 unnumbered" number="">
<h2>EXERCISES</h2>
<p><strong>Write an Rmd file, containing code chunks (if applicable) and answer all the questions below. Store the file in a folder called: “./answers_exercises” in your course project folder. Give this file the same name as the title of the current Rmd file</strong></p>
</div>
<div id="the-exercise-data" class="section level2 unnumbered" number="">
<h2>The exercise data</h2>
<p>For this exercise we use the “heights” dataset.
This dataset contains heights, weights, income and ethnicity information. The information for the variables that are needed for this exercise are in the file “annotations_height.txt”.</p>
<p>It was downloaded from:</p>
<p><a href="https://github.com/rstudio/webinars/tree/master/15-RStudio-essentials/4-Projects" class="uri">https://github.com/rstudio/webinars/tree/master/15-RStudio-essentials/4-Projects</a></p>
<p>Load the data with the following code</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="wrangling.html#cb58-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb58-2"><a href="wrangling.html#cb58-2"></a></span>
<span id="cb58-3"><a href="wrangling.html#cb58-3"></a>heights_file &lt;-<span class="st"> </span>here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;heights.RDS&quot;</span>)</span>
<span id="cb58-4"><a href="wrangling.html#cb58-4"></a>heights &lt;-<span class="st"> </span><span class="kw">read_rds</span>(<span class="dt">file =</span> heights_file)</span>
<span id="cb58-5"><a href="wrangling.html#cb58-5"></a><span class="kw">head</span>(heights)</span>
<span id="cb58-6"><a href="wrangling.html#cb58-6"></a>heights</span>
<span id="cb58-7"><a href="wrangling.html#cb58-7"></a>heights_tib &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(heights)</span></code></pre></div>
<div id="exercise-1-data-inspection" class="section level3 unnumbered" number="">
<h3><mark><strong>Exercise 1; Data inspection</strong></mark></h3>
<p>1A) <code>head()</code> and <code>tail()</code>
Use the <code>head</code> and <code>tail</code> functions. The datset contains 3988 observations.</p>
<ul>
<li>What types of variables are present in the data.</li>
<li>Focus on the variables <code>id</code> <code>income</code>, <code>height</code>, <code>weight</code>, <code>sex</code> and <code>race</code></li>
</ul>
<p>1B) Call the function <code>summary()</code> on the data. {-}
What do you notice when you look at the max. and min. value for the <code>height</code>. For nicer printing (in an Rmd output file) you can use <code>pander::pander()</code> or <code>knitr::kable()</code></p>
<p>1C) Missing values
Are there any missing values in the data? Determine the number of missing values. Try creating a plots using the <code>{naniar}</code> package.</p>
</div>
<div id="exercise-2-selecting-variables-with-dplyr-and-missing-values" class="section level3 unnumbered" number="">
<h3><mark><strong>Exercise 2; Selecting variables with {dplyr} and missing values</strong></mark></h3>
<p>Subsetting data with the {dplyr} verbs <code>select()</code> and <code>filter()</code> is convenient for creating slices of the data that are of interest.</p>
<p>For this exercise we will use the variables:</p>
<p><code>id</code>, <code>income</code>, <code>height</code>, <code>weight</code>, <code>sex</code> and <code>race</code></p>
<p>2A) Subsetting
Generate a subset of the <code>heights</code> dataframe containing only these variables. Call this new dataframe <code>heights_selected</code></p>
<ul>
<li>Use <code>dplyr::select()</code></li>
<li>Use <code>%&gt;%</code></li>
<li>To find NAs, use <code>sum(is.na(dataframe))</code></li>
</ul>
<p>2B) Check the amount of NAs that you have left in the dataset</p>
<p>2C) Complete cases
To complete the data-inspection and do a bit of cleaning we can look at the records in the <code>heigths_selected</code> dataset that are complete. This means, for which we have data points for all 5 variables.</p>
<p>use the function <code>complete.cases()</code> from the {stats} package. Look at <code>?complete.cases()</code> to see how to use this function. Create a new data frame with complete case that you call <code>heights_complete</code></p>
<ul>
<li>Remember that you can use data.frame[rows, columns] to subset a dataframe with a logical vector</li>
</ul>
<p>2D) NAs in complete cases
How many NAs are present in the <code>heights_complete</code> dataset that you just created under 2C? What did you expect?</p>
</div>
<div id="exercise-3-filtering" class="section level3 unnumbered" number="">
<h3><mark><strong>Exercise 3; Filtering</strong></mark></h3>
<p>For the next assignment you can use the <code>filter()</code> command from {dplyr}</p>
<p>3A) Filter all people that have a weight of over 200 lbs {-}</p>
<p>3B) Who is most overweighted?
What is the most frequent ethnicity in the group of people that have a weight over 200 lbs</p>
<ul>
<li>Think about how you can answer this question: you want to have some sort of tabular summary! Discuss with your neighbour. And/or look on the internet.</li>
</ul>
<p>3C) Filter to extract the top 5 tallest hispanic males in the dataset<br />
What is their respective weight?
What is their average height?</p>
<ul>
<li>This one is already a bit more complicated:</li>
<li>Use <code>%&gt;%</code></li>
<li>Use <code>filter()</code></li>
<li>Use <code>arrange()</code> to sort in descending order</li>
</ul>
<p>3D) Finding individual datapoints
Find the two tallest women in the data. See if you can find two men that match the weight and heigt of these women.</p>
</div>
<div id="exercise-4-creating-new-variables" class="section level3 unnumbered" number="">
<h3><strong><mark>Exercise 4; Creating new variables</strong></mark></h3>
<p>The units of the data in the <code>heights</code> dataset is somewhat difficult to interpret because of the use of non-SI notation (so basically non-scientific units). The weights are in <code>lbs</code> or also called pounds and the height is in <code>inches</code>.</p>
<ul>
<li>1 inch = 2.54 cm</li>
<li>1 lbs = 0.45359237 kg</li>
</ul>
<p>4A) Convert the <code>height</code> and the <code>weight</code> variable to SI units (so meters, and kg, respectively)</p>
<p>Add the new variables to the exsting <code>heigths_complete</code> dataset. Call the new columns: <code>height_m</code> and <code>weight_kg</code></p>
<ul>
<li>Use <code>dplyr::mutate()</code> to solve this question</li>
<li>Round the <code>height_m</code> and <code>weight_kg</code> to decimals that make sense</li>
</ul>
<p>4B) Body-mass index
The body-mass index or BMI can be calculated from the weight and the height of a person.</p>
<p>The formula for determining the BMI is</p>
<p>Bodyweight in kilograms divided by height in meters squared</p>
<p>or in formula form:</p>
<p><span class="math inline">\(BMI=\frac{bodyweight(kg)}{height(meters)^2}\)</span></p>
<p>4C) Calculate a new variale called <code>bmi</code> for the <code>heights_complete</code> dataset</p>
</div>
<div id="exercise-5-grouping-and-summarizing" class="section level3 unnumbered" number="">
<h3><mark><strong>Exercise 5; Grouping and summarizing</strong></mark></h3>
<p>When we have multiple observations per unit or groups of units, it makes sense to be able to group the data accordingly.</p>
<p>Here we need to take a closer look at <code>dplyr::group_by</code> and <code>dplyr::summarize</code> to group, summarize and generate new summary variables of the (cleaned) data.</p>
<p>5A) Summarize the data</p>
<ul>
<li>Group the data by <code>race</code>, and <code>sex</code>, drop the <code>id</code>, variable</li>
<li>Call the new summarized dataframe: <code>heights_summary</code></li>
<li>Make a <code>summary</code> dataframe with new summary variables with the <code>dplyr::summary()</code>function</li>
<li>Call the new summary variables <code>mean_height_in</code>, <code>mean_weight_lbs</code>, <code>mean_height_m</code>, <code>mean_weight_kg</code>, <code>mean_bmi</code> and <code>mean_income</code></li>
<li>Rank (<code>dplyr::arrange()</code>) the data according income from high to low (<code>arrange(desc(variable_for_which_to_rank)</code>)</li>
</ul>
<p>5B) Which race has the highest income?</p>
<p>5C) Gender difference in mean income?</p>
<p>Is there a difference between males and females. For which race is this difference the biggest? Also create a plot to confirm this observation.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="viz.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="tidydata.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/uashogeschoolutrecht/staRters/edit/master/ch08-wrangling.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["exploratory_data_analysis.pdf", "exploratory_data_analysis.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
