<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 11 Tidy Data | staRters; An introductory workshop for analysis of data with R</title>
  <meta name="description" content="HU Ontwikkelfestival, 2-4 November, 2020" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 11 Tidy Data | staRters; An introductory workshop for analysis of data with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="HU Ontwikkelfestival, 2-4 November, 2020" />
  <meta name="github-repo" content="uashogeschoolutrecht/staRters" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 11 Tidy Data | staRters; An introductory workshop for analysis of data with R" />
  
  <meta name="twitter:description" content="HU Ontwikkelfestival, 2-4 November, 2020" />
  

<meta name="author" content="Marc A.T. Teunis, PhD" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="wrangling.html"/>
<link rel="next" href="importingdata.html"/>
<script src="libs/header-attrs-2.4/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.2/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.15/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<script src="libs/d3-5.7.0/d3.min.js"></script>
<script src="libs/d3-lasso-0.0.5/d3-lasso.min.js"></script>
<link href="libs/ggiraphjs-0.3.0/ggiraphjs.min.css" rel="stylesheet" />
<script src="libs/ggiraphjs-0.3.0/ggiraphjs.min.js"></script>
<script src="libs/girafe-binding-0.7.8/girafe.js"></script>
<link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet" />
<script src="libs/str_view-binding-1.4.0/str_view.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Analysis with R for staRters</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="why-r.html"><a href="why-r.html"><i class="fa fa-check"></i><b>2</b> Why use R?</a></li>
<li class="chapter" data-level="3" data-path="gettingstarted.html"><a href="gettingstarted.html"><i class="fa fa-check"></i><b>3</b> Getting Started</a></li>
<li class="chapter" data-level="4" data-path="edacase.html"><a href="edacase.html"><i class="fa fa-check"></i><b>4</b> Case Example</a></li>
<li class="chapter" data-level="5" data-path="introrstudio.html"><a href="introrstudio.html"><i class="fa fa-check"></i><b>5</b> Introduction to RStudio</a></li>
<li class="chapter" data-level="6" data-path="rmarkdown.html"><a href="rmarkdown.html"><i class="fa fa-check"></i><b>6</b> Literate Programming with RMarkdown</a></li>
<li class="chapter" data-level="7" data-path="intror.html"><a href="intror.html"><i class="fa fa-check"></i><b>7</b> Introduction to R</a></li>
<li class="chapter" data-level="8" data-path="recursivevectors.html"><a href="recursivevectors.html"><i class="fa fa-check"></i><b>8</b> Lists and dataframes</a></li>
<li class="chapter" data-level="9" data-path="viz.html"><a href="viz.html"><i class="fa fa-check"></i><b>9</b> Visualize &amp; Explore Data</a></li>
<li class="chapter" data-level="10" data-path="wrangling.html"><a href="wrangling.html"><i class="fa fa-check"></i><b>10</b> Data Wrangling</a></li>
<li class="chapter" data-level="11" data-path="tidydata.html"><a href="tidydata.html"><i class="fa fa-check"></i><b>11</b> Tidy Data</a></li>
<li class="chapter" data-level="12" data-path="importingdata.html"><a href="importingdata.html"><i class="fa fa-check"></i><b>12</b> Importing data</a></li>
<li class="chapter" data-level="13" data-path="assumptions.html"><a href="assumptions.html"><i class="fa fa-check"></i><b>13</b> Assumptions and statistical models</a></li>
<li class="chapter" data-level="14" data-path="sampling-bootstrapping.html"><a href="sampling-bootstrapping.html"><i class="fa fa-check"></i><b>14</b> Sampling, Probability distributions and bootstrapping</a></li>
<li class="chapter" data-level="15" data-path="resources.html"><a href="resources.html"><i class="fa fa-check"></i><b>15</b> Resources</a></li>
<li class="divider"></li>
<li><a href="https://github.com/uashogeschoolutrecht/staRters" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">staRters; An introductory workshop for analysis of data with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tidydata" class="section level1" number="11">
<h1><span class="header-section-number">Chapter 11</span> Tidy Data</h1>
<div id="credits" class="section level2" number="11.1">
<h2><span class="header-section-number">11.1</span> Credits</h2>
<p>The contents of this chapter are (partly) reproduced from <span class="citation">(Hadley Wickham <a href="#ref-r4ds" role="doc-biblioref">2017</a>)</span></p>
</div>
<div id="introduction" class="section level2" number="11.2">
<h2><span class="header-section-number">11.2</span> Introduction</h2>
<ul>
<li>In this lesson, you will learn a consistent way to structure your data in R, in a framework called <strong>tidy data</strong>.</li>
<li>Getting your data into this format requires some upfront work, but that work pays off in the long term.</li>
<li>Once you have tidy data and the tidy tools provided by packages in the tidyverse and others, you will spend much less time munging data from one representation to another, allowing you to spend more time on the analytic questions at hand.</li>
</ul>
</div>
<div id="tidyr-package" class="section level2" number="11.3">
<h2><span class="header-section-number">11.3</span> <code>{tidyr}</code> package</h2>
<ul>
<li>This lesson will give you a practical introduction to tidy data and the accompanying tools in the <strong>tidyr</strong> package.</li>
</ul>
<p>If you’d like to learn more about the underlying theory, you might enjoy the <em>Tidy Data</em> paper published in the Journal of Statistical Software, <a href="http://www.jstatsoft.org/v59/i10/paper" class="uri">http://www.jstatsoft.org/v59/i10/paper</a>.</p>
</div>
<div id="prerequisites" class="section level2" number="11.4">
<h2><span class="header-section-number">11.4</span> Prerequisites</h2>
<p>In this chapter we’ll focus on tidyr, a package that provides a bunch of tools to help tidy up your messy datasets. tidyr is a member of the core tidyverse.</p>
<div class="sourceCode" id="cb677"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb677-1"><a href="tidydata.html#cb677-1"></a><span class="kw">library</span>(tidyverse)</span></code></pre></div>
<p><img src="images/tidyr_sticker.png" width="222" /></p>
</div>
<div id="tidy-data-rules" class="section level2" number="11.5">
<h2><span class="header-section-number">11.5</span> Tidy data rules</h2>
<p><img src="images/tidy-1.png" width="737" /></p>
<ul>
<li>Each variable goes in it’s own column</li>
<li>Each observation goes in a singe row</li>
<li>Each cell contains only one value</li>
</ul>
<p><strong><strong>You will need them in (almost) every analysis!</strong></strong></p>
</div>
<div id="examples" class="section level2" number="11.6">
<h2><span class="header-section-number">11.6</span> Examples</h2>
<ul>
<li>This dataset concerns tuberculosis incidence in multiple countries over 2 years</li>
<li>Each dataset shows the same values of four variables <em>country</em>, <em>year</em>, <em>population</em>, and <em>cases</em></li>
<li>Ask yourself: “How are the following tables different?”</li>
<li>Check if, and how the table complies to the tidy data rules</li>
</ul>
</div>
<div id="example-1" class="section level2" number="11.7">
<h2><span class="header-section-number">11.7</span> Example 1</h2>
<div class="sourceCode" id="cb678"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb678-1"><a href="tidydata.html#cb678-1"></a><span class="kw">head</span>(table1, <span class="dv">6</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   country      year  cases population
##   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan  1999    745   19987071
## 2 Afghanistan  2000   2666   20595360
## 3 Brazil       1999  37737  172006362
## 4 Brazil       2000  80488  174504898
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
</div>
<div id="example-2" class="section level2" number="11.8">
<h2><span class="header-section-number">11.8</span> Example 2</h2>
<div class="sourceCode" id="cb680"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb680-1"><a href="tidydata.html#cb680-1"></a><span class="kw">head</span>(table2, <span class="dv">6</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   country      year type           count
##   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;          &lt;int&gt;
## 1 Afghanistan  1999 cases            745
## 2 Afghanistan  1999 population  19987071
## 3 Afghanistan  2000 cases           2666
## 4 Afghanistan  2000 population  20595360
## 5 Brazil       1999 cases          37737
## 6 Brazil       1999 population 172006362</code></pre>
</div>
<div id="example-3" class="section level2" number="11.9">
<h2><span class="header-section-number">11.9</span> Example 3</h2>
<div class="sourceCode" id="cb682"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb682-1"><a href="tidydata.html#cb682-1"></a><span class="kw">head</span>(table3, <span class="dv">6</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   country      year rate             
##   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;            
## 1 Afghanistan  1999 745/19987071     
## 2 Afghanistan  2000 2666/20595360    
## 3 Brazil       1999 37737/172006362  
## 4 Brazil       2000 80488/174504898  
## 5 China        1999 212258/1272915272
## 6 China        2000 213766/1280428583</code></pre>
</div>
<div id="data-can-be-spread-across-multiple-filestables" class="section level2" number="11.10">
<h2><span class="header-section-number">11.10</span> Data can be spread across multiple files/tables</h2>
<div class="sourceCode" id="cb684"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb684-1"><a href="tidydata.html#cb684-1"></a><span class="kw">head</span>(table4a, <span class="dv">3</span>)  <span class="co"># cases</span></span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   country     `1999` `2000`
##   &lt;chr&gt;        &lt;int&gt;  &lt;int&gt;
## 1 Afghanistan    745   2666
## 2 Brazil       37737  80488
## 3 China       212258 213766</code></pre>
<div class="sourceCode" id="cb686"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb686-1"><a href="tidydata.html#cb686-1"></a><span class="kw">head</span>(table4b, <span class="dv">3</span>)  <span class="co"># population</span></span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   country         `1999`     `2000`
##   &lt;chr&gt;            &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan   19987071   20595360
## 2 Brazil       172006362  174504898
## 3 China       1272915272 1280428583</code></pre>
</div>
<div id="one-winner" class="section level2" number="11.11">
<h2><span class="header-section-number">11.11</span> One winner!</h2>
<p>In the previous example, only <code>table1</code> is tidy. It’s the only representation where each column is a variable.</p>
<div class="sourceCode" id="cb688"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb688-1"><a href="tidydata.html#cb688-1"></a><span class="kw">head</span>(table1)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   country      year  cases population
##   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan  1999    745   19987071
## 2 Afghanistan  2000   2666   20595360
## 3 Brazil       1999  37737  172006362
## 4 Brazil       2000  80488  174504898
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
</div>
<div id="why-tidy-data" class="section level2" number="11.12">
<h2><span class="header-section-number">11.12</span> Why tidy data?</h2>
<p>Why ensure that your data is tidy? There are two main advantages:</p>
<ol style="list-style-type: decimal">
<li><p>There’s a general advantage to picking one consistent way of storing data. If you have a consistent data structure, it’s easier to learn the tools that work with it because they have an underlying uniformity.</p></li>
<li><p>There’s a specific advantage to placing variables in columns because they are vectors. Most built-in R functions work with vectors of values.</p></li>
</ol>
</div>
<div id="packages-from-the-tidyverse-are-designed-for-tidy-data" class="section level2" number="11.13">
<h2><span class="header-section-number">11.13</span> Packages from the tidyverse are designed for tidy data</h2>
<p>Example plot from <code>table1</code></p>
<div class="sourceCode" id="cb690"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb690-1"><a href="tidydata.html#cb690-1"></a><span class="co"># Compute rate per 10,000</span></span>
<span id="cb690-2"><a href="tidydata.html#cb690-2"></a>table1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb690-3"><a href="tidydata.html#cb690-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rate =</span> cases <span class="op">/</span><span class="st"> </span>population <span class="op">*</span><span class="st"> </span><span class="dv">10000</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   country      year  cases population  rate
##   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt; &lt;dbl&gt;
## 1 Afghanistan  1999    745   19987071 0.373
## 2 Afghanistan  2000   2666   20595360 1.29 
## 3 Brazil       1999  37737  172006362 2.19 
## 4 Brazil       2000  80488  174504898 4.61 
## 5 China        1999 212258 1272915272 1.67 
## 6 China        2000 213766 1280428583 1.67</code></pre>
</div>
<div id="compute-cases-per-year" class="section level2" number="11.14">
<h2><span class="header-section-number">11.14</span> Compute cases per year</h2>
<div class="sourceCode" id="cb692"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb692-1"><a href="tidydata.html#cb692-1"></a>table1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb692-2"><a href="tidydata.html#cb692-2"></a><span class="st">  </span><span class="kw">count</span>(year, <span class="dt">wt =</span> cases)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##    year      n
##   &lt;int&gt;  &lt;int&gt;
## 1  1999 250740
## 2  2000 296920</code></pre>
<div id="exercise-1-visualize-changes-over-time" class="section level3 unnumbered" number="">
<h3><mark><strong>EXERCISE 1 Visualize changes over time</strong></mark></h3>
<ol style="list-style-type: upper-alpha">
<li><p>Create a plot from <code>table1</code> tuberculosis data, showing the number of cases from each country.</p></li>
<li><p>Now plot the incidence (number of cases per 10,000 people) for each country.</p></li>
<li><p>What can you conclude from the plots in exercise 1A) and 1B)</p></li>
</ol>
</div>
</div>
<div id="gathering" class="section level2" number="11.15">
<h2><span class="header-section-number">11.15</span> Gathering</h2>
<p>When some of the column names are not names of variables, but <em>values</em> of a variable. Take <code>table4a</code>: the column names <code>1999</code> and <code>2000</code> represent values of the <code>year</code> variable, and each row represents two observations, not one.</p>
<div class="sourceCode" id="cb694"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb694-1"><a href="tidydata.html#cb694-1"></a>table4a</span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   country     `1999` `2000`
## * &lt;chr&gt;        &lt;int&gt;  &lt;int&gt;
## 1 Afghanistan    745   2666
## 2 Brazil       37737  80488
## 3 China       212258 213766</code></pre>
</div>
<div id="gathering-a-set-of-value-columns" class="section level2" number="11.16">
<h2><span class="header-section-number">11.16</span> Gathering a set of value columns</h2>
<p>To tidy a dataset like this, we need to <strong>gather</strong> those columns into a new pair of variables. To describe that operation we need three parameters:</p>
<ul>
<li>The set of columns that represent values, not variables. In this example,
those are the columns <code>1999</code> and <code>2000</code>.</li>
<li>The name of the variable whose values form the column names. I call that
the <code>key</code>, and here it is <code>year</code>.</li>
<li>The name of the variable whose values are spread over the cells. I call
that <code>value</code>, and here it’s the number of <code>cases</code>.</li>
</ul>
</div>
<div id="gather" class="section level2" number="11.17">
<h2><span class="header-section-number">11.17</span> “gather()”</h2>
<div class="sourceCode" id="cb696"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb696-1"><a href="tidydata.html#cb696-1"></a>table4a <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb696-2"><a href="tidydata.html#cb696-2"></a><span class="st">  </span><span class="kw">gather</span>(<span class="st">`</span><span class="dt">1999</span><span class="st">`</span>, <span class="st">`</span><span class="dt">2000</span><span class="st">`</span>, <span class="dt">key =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;cases&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   country     year   cases
##   &lt;chr&gt;       &lt;chr&gt;  &lt;int&gt;
## 1 Afghanistan 1999     745
## 2 Brazil      1999   37737
## 3 China       1999  212258
## 4 Afghanistan 2000    2666
## 5 Brazil      2000   80488
## 6 China       2000  213766</code></pre>
</div>
<div id="the-actions-gather-performs" class="section level2" number="11.18">
<h2><span class="header-section-number">11.18</span> The actions “gather()” performs</h2>
<div class="figure"><span id="fig:tidy-gather"></span>
<img src="images/tidy-9.png" alt="Gathering `table4` into a tidy form." width="100%" />
<p class="caption">
Figure 11.1: Gathering <code>table4</code> into a tidy form.
</p>
</div>
</div>
<div id="tidy-table-4b" class="section level2" number="11.19">
<h2><span class="header-section-number">11.19</span> Tidy table 4b</h2>
<div class="sourceCode" id="cb698"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb698-1"><a href="tidydata.html#cb698-1"></a>table4b <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb698-2"><a href="tidydata.html#cb698-2"></a><span class="st">  </span><span class="kw">gather</span>(<span class="st">`</span><span class="dt">1999</span><span class="st">`</span>, <span class="st">`</span><span class="dt">2000</span><span class="st">`</span>, <span class="dt">key =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;population&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   country     year  population
##   &lt;chr&gt;       &lt;chr&gt;      &lt;int&gt;
## 1 Afghanistan 1999    19987071
## 2 Brazil      1999   172006362
## 3 China       1999  1272915272
## 4 Afghanistan 2000    20595360
## 5 Brazil      2000   174504898
## 6 China       2000  1280428583</code></pre>
<div id="exercise-2-gathering-columns" class="section level3 unnumbered" number="">
<h3><mark><strong>EXERCISE 2 Gathering columns</strong></mark></h3>
<p>The data file “./data/messy_excel.xlsx” is not very tidy. Open the file in Excel. Discuss with you neighbour how you would tidy the data in this file, without changing anything in the Excel file. Write down your plan. try to develop a stepwise protocol that includes code-snippets and/or pseudo code.</p>
<p><strong>TIPS</strong></p>
<ol style="list-style-type: decimal">
<li>You can define a range to be parsed in the readxl package</li>
<li>You will need gather some columns in the data</li>
<li>You might want to parse the file 2 times with different ranges to get all the data into R</li>
<li>First try to parse the file as it is to see what R makes of the file and try to design (in Excel if you want) the end result that you would like to achieve.</li>
</ol>
<p><em>This is a difficult exercise and it will take you some time to figure out how to achieve this, take the time to look for additional online information</em></p>
</div>
</div>
<div id="joining-tables" class="section level2" number="11.20">
<h2><span class="header-section-number">11.20</span> Joining tables</h2>
<p>To combine the tidied versions of <code>table4a</code> and <code>table4b</code> into a single tibble, we need to use <code>dplyr::left_join()</code></p>
<div class="sourceCode" id="cb700"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb700-1"><a href="tidydata.html#cb700-1"></a>tidy4a &lt;-<span class="st"> </span>table4a <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb700-2"><a href="tidydata.html#cb700-2"></a><span class="st">  </span><span class="kw">gather</span>(<span class="st">`</span><span class="dt">1999</span><span class="st">`</span>, <span class="st">`</span><span class="dt">2000</span><span class="st">`</span>, <span class="dt">key =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;cases&quot;</span>)</span>
<span id="cb700-3"><a href="tidydata.html#cb700-3"></a>tidy4b &lt;-<span class="st"> </span>table4b <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb700-4"><a href="tidydata.html#cb700-4"></a><span class="st">  </span><span class="kw">gather</span>(<span class="st">`</span><span class="dt">1999</span><span class="st">`</span>, <span class="st">`</span><span class="dt">2000</span><span class="st">`</span>, <span class="dt">key =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;population&quot;</span>)</span>
<span id="cb700-5"><a href="tidydata.html#cb700-5"></a>joined_4a_4b &lt;-<span class="st"> </span><span class="kw">left_join</span>(tidy4a, tidy4b)</span>
<span id="cb700-6"><a href="tidydata.html#cb700-6"></a>joined_4a_4b</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   country     year   cases population
##   &lt;chr&gt;       &lt;chr&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan 1999     745   19987071
## 2 Brazil      1999   37737  172006362
## 3 China       1999  212258 1272915272
## 4 Afghanistan 2000    2666   20595360
## 5 Brazil      2000   80488  174504898
## 6 China       2000  213766 1280428583</code></pre>
</div>
<div id="spreading" class="section level2" number="11.21">
<h2><span class="header-section-number">11.21</span> Spreading</h2>
<p>Spreading is the opposite of gathering. You use it when an observation is scattered across multiple rows. For example, take <code>table2</code>: an observation is a country in a year, but each observation is spread across two rows.</p>
<div class="sourceCode" id="cb702"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb702-1"><a href="tidydata.html#cb702-1"></a>table2</span></code></pre></div>
<pre><code>## # A tibble: 12 x 4
##    country      year type            count
##    &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;           &lt;int&gt;
##  1 Afghanistan  1999 cases             745
##  2 Afghanistan  1999 population   19987071
##  3 Afghanistan  2000 cases            2666
##  4 Afghanistan  2000 population   20595360
##  5 Brazil       1999 cases           37737
##  6 Brazil       1999 population  172006362
##  7 Brazil       2000 cases           80488
##  8 Brazil       2000 population  174504898
##  9 China        1999 cases          212258
## 10 China        1999 population 1272915272
## 11 China        2000 cases          213766
## 12 China        2000 population 1280428583</code></pre>
<p>To tidy this up, we first analyse the representation in similar way to <code>gather()</code>. This time, however, we only need two parameters:</p>
<ul>
<li>The column that contains variable names, the <code>key</code> column. Here, it’s
<code>type</code>.</li>
<li>The column that contains values forms multiple variables, the <code>value</code>
column. Here it’s <code>count</code>.</li>
</ul>
</div>
<div id="spread" class="section level2" number="11.22">
<h2><span class="header-section-number">11.22</span> “spread()”</h2>
<div class="sourceCode" id="cb704"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb704-1"><a href="tidydata.html#cb704-1"></a><span class="kw">spread</span>(table2, <span class="dt">key =</span> type, <span class="dt">value =</span> count)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   country      year  cases population
##   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan  1999    745   19987071
## 2 Afghanistan  2000   2666   20595360
## 3 Brazil       1999  37737  172006362
## 4 Brazil       2000  80488  174504898
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
</div>
<div id="the-action-spread-performs" class="section level2" number="11.23">
<h2><span class="header-section-number">11.23</span> The action “spread()” performs</h2>
<div class="figure"><span id="fig:tidy-spread"></span>
<img src="images/tidy-8.png" alt="Spreading `table2` makes it tidy" width="100%" />
<p class="caption">
Figure 11.2: Spreading <code>table2</code> makes it tidy
</p>
</div>
</div>
<div id="gather-and-spread-are-complementary" class="section level2" number="11.24">
<h2><span class="header-section-number">11.24</span> “gather()” and “spread()” are complementary</h2>
<p>As you might have guessed from the common <code>key</code> and <code>value</code> arguments, <code>spread()</code> and <code>gather()</code> are complements. <code>gather()</code> makes wide tables narrower and longer; <code>spread()</code> makes long tables shorter and wider.</p>
</div>
<div id="separating-and-uniting" class="section level2" number="11.25">
<h2><span class="header-section-number">11.25</span> Separating and uniting</h2>
<p><code>table3</code> has a different problem: we have one column (<code>rate</code>) that contains two variables (<code>cases</code> and <code>population</code>). To fix this problem, we’ll need the <code>separate()</code> function. You’ll also learn about the complement of <code>separate()</code>: <code>unite()</code>, which you use if a single variable is spread across multiple columns.</p>
</div>
<div id="separate" class="section level2" number="11.26">
<h2><span class="header-section-number">11.26</span> “separate()”</h2>
<p><code>separate()</code> pulls apart one column into multiple columns, by splitting wherever a separator character appears. Take <code>table3</code>:</p>
<div class="sourceCode" id="cb706"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb706-1"><a href="tidydata.html#cb706-1"></a>table3</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   country      year rate             
## * &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;            
## 1 Afghanistan  1999 745/19987071     
## 2 Afghanistan  2000 2666/20595360    
## 3 Brazil       1999 37737/172006362  
## 4 Brazil       2000 80488/174504898  
## 5 China        1999 212258/1272915272
## 6 China        2000 213766/1280428583</code></pre>
</div>
<div id="separating-rate-into-cases-and-population" class="section level2" number="11.27">
<h2><span class="header-section-number">11.27</span> Separating rate into cases and population</h2>
<div class="sourceCode" id="cb708"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb708-1"><a href="tidydata.html#cb708-1"></a>table3 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb708-2"><a href="tidydata.html#cb708-2"></a><span class="st">  </span><span class="kw">separate</span>(rate, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;population&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   country      year cases  population
##   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;     
## 1 Afghanistan  1999 745    19987071  
## 2 Afghanistan  2000 2666   20595360  
## 3 Brazil       1999 37737  172006362 
## 4 Brazil       2000 80488  174504898 
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
</div>
<div id="the-action-separate-performs" class="section level2" number="11.28">
<h2><span class="header-section-number">11.28</span> The action “separate()” performs</h2>
<div class="figure"><span id="fig:tidy-separate"></span>
<img src="images/tidy-17.png" alt="Separating `table3` makes it tidy" width="75%" />
<p class="caption">
Figure 11.3: Separating <code>table3</code> makes it tidy
</p>
</div>
</div>
<div id="unite" class="section level2" number="11.29">
<h2><span class="header-section-number">11.29</span> Unite</h2>
<p><code>unite()</code> is the inverse of <code>separate()</code>: it combines multiple columns into a single column.</p>
<p>Look at <code>?tidyrt::unite()</code> to see the help and examples</p>
</div>
<div id="missing-values" class="section level2" number="11.30">
<h2><span class="header-section-number">11.30</span> Missing values</h2>
<p>Changing the representation of a dataset brings up an important subtlety of missing values. Surprisingly, a value can be missing in one of two possible ways:</p>
<ul>
<li><strong>Explicitly</strong>, i.e. flagged with <code>NA</code>.</li>
<li><strong>Implicitly</strong>, i.e. simply not present in the data.</li>
</ul>
<p>Let’s illustrate this idea with a very simple data set:</p>
<div class="sourceCode" id="cb710"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb710-1"><a href="tidydata.html#cb710-1"></a>stocks &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb710-2"><a href="tidydata.html#cb710-2"></a>  <span class="dt">year   =</span> <span class="kw">c</span>(<span class="dv">2015</span>, <span class="dv">2015</span>, <span class="dv">2015</span>, <span class="dv">2015</span>, <span class="dv">2016</span>, <span class="dv">2016</span>, <span class="dv">2016</span>),</span>
<span id="cb710-3"><a href="tidydata.html#cb710-3"></a>  <span class="dt">qtr    =</span> <span class="kw">c</span>(   <span class="dv">1</span>,    <span class="dv">2</span>,    <span class="dv">3</span>,    <span class="dv">4</span>,    <span class="dv">2</span>,    <span class="dv">3</span>,    <span class="dv">4</span>),</span>
<span id="cb710-4"><a href="tidydata.html#cb710-4"></a>  <span class="dt">return =</span> <span class="kw">c</span>(<span class="fl">1.88</span>, <span class="fl">0.59</span>, <span class="fl">0.35</span>,   <span class="ot">NA</span>, <span class="fl">0.92</span>, <span class="fl">0.17</span>, <span class="fl">2.66</span>)</span>
<span id="cb710-5"><a href="tidydata.html#cb710-5"></a>)</span></code></pre></div>
</div>
<div id="the-stocks-dataframe" class="section level2" number="11.31">
<h2><span class="header-section-number">11.31</span> The stocks dataframe</h2>
<div class="sourceCode" id="cb711"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb711-1"><a href="tidydata.html#cb711-1"></a>stocks</span></code></pre></div>
<pre><code>## # A tibble: 7 x 3
##    year   qtr return
##   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1  2015     1   1.88
## 2  2015     2   0.59
## 3  2015     3   0.35
## 4  2015     4  NA   
## 5  2016     2   0.92
## 6  2016     3   0.17
## 7  2016     4   2.66</code></pre>
</div>
<div id="there-are-two-missing-values-in-this-dataset" class="section level2" number="11.32">
<h2><span class="header-section-number">11.32</span> There are two missing values in this dataset:</h2>
<ul>
<li>The return for the fourth quarter of 2015 is explicitly missing, because the cell where its value should be instead contains <code>NA</code>.</li>
<li>The return for the first quarter of 2016 is implicitly missing, because it simply does not appear in the dataset.</li>
</ul>
</div>
<div id="making-implicit-missing-values-explicit" class="section level2" number="11.33">
<h2><span class="header-section-number">11.33</span> Making implicit missing values explicit</h2>
<p>The way that a dataset is represented can make implicit values explicit. For example, we can make the implicit missing value explicit by putting years in the columns:</p>
<div class="sourceCode" id="cb713"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb713-1"><a href="tidydata.html#cb713-1"></a>stocks <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb713-2"><a href="tidydata.html#cb713-2"></a><span class="st">  </span><span class="kw">spread</span>(year, return)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##     qtr `2015` `2016`
##   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1     1   1.88  NA   
## 2     2   0.59   0.92
## 3     3   0.35   0.17
## 4     4  NA      2.66</code></pre>
</div>
<div id="na.rm-true" class="section level2" number="11.34">
<h2><span class="header-section-number">11.34</span> “na.rm = TRUE”</h2>
<p>Because these explicit missing values may not be important in other representations of the data, you can set <code>na.rm = TRUE</code> in <code>gather()</code> to turn explicit missing values implicit:</p>
<div class="sourceCode" id="cb715"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb715-1"><a href="tidydata.html#cb715-1"></a>stocks <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb715-2"><a href="tidydata.html#cb715-2"></a><span class="st">  </span><span class="kw">spread</span>(year, return) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb715-3"><a href="tidydata.html#cb715-3"></a><span class="st">  </span><span class="kw">gather</span>(year, return, <span class="st">`</span><span class="dt">2015</span><span class="st">`</span><span class="op">:</span><span class="st">`</span><span class="dt">2016</span><span class="st">`</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##     qtr year  return
##   &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;
## 1     1 2015    1.88
## 2     2 2015    0.59
## 3     3 2015    0.35
## 4     2 2016    0.92
## 5     3 2016    0.17
## 6     4 2016    2.66</code></pre>
</div>
<div id="explicit-missing-values-complete" class="section level2" number="11.35">
<h2><span class="header-section-number">11.35</span> Explicit missing values “complete()”</h2>
<p>Another important tool for making missing values explicit in tidy data is <code>complete()</code>:</p>
<div class="sourceCode" id="cb717"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb717-1"><a href="tidydata.html#cb717-1"></a>stocks <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb717-2"><a href="tidydata.html#cb717-2"></a><span class="st">  </span><span class="kw">complete</span>(year, qtr)</span></code></pre></div>
<pre><code>## # A tibble: 8 x 3
##    year   qtr return
##   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1  2015     1   1.88
## 2  2015     2   0.59
## 3  2015     3   0.35
## 4  2015     4  NA   
## 5  2016     1  NA   
## 6  2016     2   0.92
## 7  2016     3   0.17
## 8  2016     4   2.66</code></pre>
</div>
<div id="the-complete-function" class="section level2" number="11.36">
<h2><span class="header-section-number">11.36</span> The “complete()” function</h2>
<p><code>complete()</code> takes a set of columns, and finds all unique combinations. It then ensures the original dataset contains all those values, filling in explicit <code>NA</code>s where necessary.</p>
</div>
<div id="forward-carrying" class="section level2" number="11.37">
<h2><span class="header-section-number">11.37</span> Forward carrying</h2>
<p>Sometimes when a data source has primarily been used for data entry, missing values indicate that the previous value should be carried forward:</p>
</div>
<div id="carry-forward-example" class="section level2" number="11.38">
<h2><span class="header-section-number">11.38</span> Carry-forward example</h2>
<div class="sourceCode" id="cb719"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb719-1"><a href="tidydata.html#cb719-1"></a>(treatment &lt;-<span class="st"> </span><span class="kw">tribble</span>(</span>
<span id="cb719-2"><a href="tidydata.html#cb719-2"></a>  <span class="op">~</span><span class="st"> </span>person,            <span class="op">~</span><span class="st"> </span>treatment, <span class="op">~</span>response,</span>
<span id="cb719-3"><a href="tidydata.html#cb719-3"></a>  <span class="st">&quot;Hans Anders&quot;</span>,       <span class="dv">1</span>,           <span class="dv">7</span>,</span>
<span id="cb719-4"><a href="tidydata.html#cb719-4"></a>  <span class="ot">NA</span>,                  <span class="dv">2</span>,           <span class="dv">10</span>,</span>
<span id="cb719-5"><a href="tidydata.html#cb719-5"></a>  <span class="ot">NA</span>,                  <span class="dv">3</span>,           <span class="dv">9</span>,</span>
<span id="cb719-6"><a href="tidydata.html#cb719-6"></a>  <span class="st">&quot;Alber Heijn&quot;</span>,       <span class="dv">1</span>,           <span class="dv">4</span>,</span>
<span id="cb719-7"><a href="tidydata.html#cb719-7"></a>  <span class="ot">NA</span>,                  <span class="dv">2</span>,           <span class="dv">8</span>,</span>
<span id="cb719-8"><a href="tidydata.html#cb719-8"></a>  <span class="ot">NA</span>,                  <span class="dv">3</span>,           <span class="dv">12</span></span>
<span id="cb719-9"><a href="tidydata.html#cb719-9"></a>))</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   person      treatment response
##   &lt;chr&gt;           &lt;dbl&gt;    &lt;dbl&gt;
## 1 Hans Anders         1        7
## 2 &lt;NA&gt;                2       10
## 3 &lt;NA&gt;                3        9
## 4 Alber Heijn         1        4
## 5 &lt;NA&gt;                2        8
## 6 &lt;NA&gt;                3       12</code></pre>
</div>
<div id="filling-in-the-missing-values" class="section level2" number="11.39">
<h2><span class="header-section-number">11.39</span> Filling in the ‘missing values’</h2>
<p>You can fill in these missing values with <code>fill()</code>. It takes a set of columns where you want missing values to be replaced by the most recent non-missing value (sometimes called last observation carried forward).</p>
<div class="sourceCode" id="cb721"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb721-1"><a href="tidydata.html#cb721-1"></a>treatment <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb721-2"><a href="tidydata.html#cb721-2"></a><span class="st">  </span><span class="kw">fill</span>(person)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   person      treatment response
##   &lt;chr&gt;           &lt;dbl&gt;    &lt;dbl&gt;
## 1 Hans Anders         1        7
## 2 Hans Anders         2       10
## 3 Hans Anders         3        9
## 4 Alber Heijn         1        4
## 5 Alber Heijn         2        8
## 6 Alber Heijn         3       12</code></pre>
<div id="exercise-3-inspecting-tidyness" class="section level3 unnumbered" number="">
<h3><mark><strong>EXERCISE 3 Inspecting tidyness</strong></mark></h3>
<p>3A) Describe how the variables and observations are organised in each of the sample tables:
<code>table1</code>, <code>table2</code>, <code>table3</code>, <code>table4a</code>, <code>table4b</code>.</p>
<p>3B) Compute the <code>rate</code> for <code>table2</code>, and <code>table4a</code> + <code>table4b</code>.</p>
<p><strong>STEPS</strong></p>
<p>You will need to perform four operations:</p>
<ol style="list-style-type: decimal">
<li>Extract the number of TB cases per country per year.</li>
<li>Extract the matching population per country per year.</li>
<li>Divide cases by population, and multiply by 10000.</li>
<li>Store back in the appropriate place.</li>
<li>Sort the data according year (ascending)</li>
</ol>
<p><strong>TIPS</strong></p>
<ul>
<li>You will need {tidyr} and {dplyr}</li>
<li>You will also need <code>mutate()</code> to calculate the rate</li>
<li>Use the pipe <code>%&gt;%</code></li>
<li>Rember <code>gather()</code> collects observations in columns into variable columns (from wide to stacked) and <code>spread()</code> unstacks variables into variable columns (from stacked to wide)</li>
<li>Table 4a contains the cases, table 4b contains the populations</li>
<li>For joining the tables 4a and 4b you can use the <code>dplyr::left_join()</code> function. See <code>help("dplyr")</code> or <code>?dplyr</code> for more information.</li>
</ul>
<p>table2</p>
<p>table 4a + 4b</p>
<p>Which representation is easiest to work with? Which is hardest? Why?</p>
</div>
<div id="exercise-4-plotting-tidy-data" class="section level3 unnumbered" number="">
<h3><mark><strong>EXERCISE 4: Plotting tidy data</strong></mark></h3>
<p>4A) Recreate the plot showing change in cases over time using <code>table2</code>
instead of <code>table1</code>. What do you need to do first?</p>
<p>4B) Why does the code below fail, can you fix it?</p>
<div class="sourceCode" id="cb723"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb723-1"><a href="tidydata.html#cb723-1"></a>    table4a <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb723-2"><a href="tidydata.html#cb723-2"></a><span class="st">      </span><span class="kw">gather</span>(<span class="dv">1999</span>, <span class="dv">2000</span>, <span class="dt">key =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;cases&quot;</span>)</span></code></pre></div>
<pre><code>## Error: Can&#39;t subset columns that don&#39;t exist.
## [31mx[39m Locations 1999 and 2000 don&#39;t exist.
## [34mi[39m There are only 3 columns.</code></pre>
</div>
<div id="exercise-5-wide-to-long-spreading-and-gathering" class="section level3 unnumbered" number="">
<h3><mark><strong>EXERCISE 5: Wide to long; Spreading and Gathering</strong></mark></h3>
<p>5A) Tidy the simple tibble below. Do you need to spread or gather it?</p>
<p>5B) Calculate the percentage of females that are pregnant, of all females in the dataset.</p>
<p>5C) How many males are there in the dataset? How many of them are pregnant ;-)</p>
</div>
<div id="exercise-6-additional-operations" class="section level3 unnumbered" number="">
<h3><mark><strong>EXERCISE 6: Additional operations</strong></mark></h3>
<p>6A) What do the <code>extra</code> and <code>fill</code> arguments do in <code>separate()</code>? Experiment with the various options for the following two toy datasets.</p>
<div class="sourceCode" id="cb725"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb725-1"><a href="tidydata.html#cb725-1"></a><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&quot;a,b,c&quot;</span>, <span class="st">&quot;d,e,f,g&quot;</span>, <span class="st">&quot;h,i,j&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb725-2"><a href="tidydata.html#cb725-2"></a><span class="kw">separate</span>(x, <span class="kw">c</span>(<span class="st">&quot;one&quot;</span>, <span class="st">&quot;two&quot;</span>, <span class="st">&quot;three&quot;</span>))</span>
<span id="cb725-3"><a href="tidydata.html#cb725-3"></a></span>
<span id="cb725-4"><a href="tidydata.html#cb725-4"></a><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&quot;a,b,c&quot;</span>, <span class="st">&quot;d,e&quot;</span>, <span class="st">&quot;f,g,i&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb725-5"><a href="tidydata.html#cb725-5"></a><span class="kw">separate</span>(x, <span class="kw">c</span>(<span class="st">&quot;one&quot;</span>, <span class="st">&quot;two&quot;</span>, <span class="st">&quot;three&quot;</span>))</span></code></pre></div>
<p>6B) Compare and contrast the functions <code>separate()</code> and <code>extract()</code>. Why are there three variations of separation (by position, by separator, and with groups), but only one unite?</p>
</div>
<div id="exercise-7-a-case" class="section level3 unnumbered" number="">
<h3><mark><strong>EXERCISE 7: A Case</strong></mark></h3>
<p>7A) Tidy the following dataset: “./data/messydata_5a.xlsx”
The data represents Mariages during the four seasons for a number of years in regions in Germany.</p>
<p>Note: Germany has 16 states. When you load the data you will notice that the coding of the factor variable “State” is not consistent. You will need to correct tihs coding in order for the data to be tidy.
Use the function from {forcats} <code>forcats::fct_recode()</code> to achieve this. This file “./data/germany_states.txt” contains information on the states. How can you load this file into R?</p>
<p><strong>TIPS</strong></p>
<ul>
<li>Use the code below to read all the sheets of the excel file, look at the help function first.</li>
<li>Which parameter of <code>read_excel()</code> controls the sheets to read?</li>
<li>To read multiple sheets, a for loop is used</li>
<li>The Excel file contains 7 sheets</li>
<li>Check spelling and values: are they consistent.</li>
<li>Read the chapter "</li>
<li>Think about <code>gather()</code> or <code>spread()</code>, which do you need?</li>
<li>To convert a list of dataframes to one dataframe look at:
the help for the function <code>dplyr::bind_rows()</code>. You will have to use this to convert the list of sheets into one dataframe.</li>
<li>The first two sheets of the Excel file contain mistakes and errors</li>
</ul>
</div>
<div id="read-data" class="section level3 unnumbered" number="">
<h3>Read data</h3>
<div class="sourceCode" id="cb726"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb726-1"><a href="tidydata.html#cb726-1"></a><span class="kw">library</span>(readxl)</span>
<span id="cb726-2"><a href="tidydata.html#cb726-2"></a></span>
<span id="cb726-3"><a href="tidydata.html#cb726-3"></a><span class="co"># path to data file</span></span>
<span id="cb726-4"><a href="tidydata.html#cb726-4"></a>path_to_messy_mariages &lt;-<span class="st"> </span><span class="kw">file.path</span>(</span>
<span id="cb726-5"><a href="tidydata.html#cb726-5"></a>  here<span class="op">::</span><span class="kw">here</span>(</span>
<span id="cb726-6"><a href="tidydata.html#cb726-6"></a>    <span class="st">&quot;data&quot;</span>, </span>
<span id="cb726-7"><a href="tidydata.html#cb726-7"></a>    <span class="st">&quot;messydata_5a.xlsx&quot;</span>))</span>
<span id="cb726-8"><a href="tidydata.html#cb726-8"></a></span>
<span id="cb726-9"><a href="tidydata.html#cb726-9"></a><span class="co"># load messy data in empty list with loop and read_excel</span></span>
<span id="cb726-10"><a href="tidydata.html#cb726-10"></a>messy_mariages &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb726-11"><a href="tidydata.html#cb726-11"></a></span>
<span id="cb726-12"><a href="tidydata.html#cb726-12"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>){</span>
<span id="cb726-13"><a href="tidydata.html#cb726-13"></a>  messy_mariages[[i]] &lt;-<span class="st"> </span><span class="kw">read_excel</span>(<span class="dt">path =</span> path_to_messy_mariages, </span>
<span id="cb726-14"><a href="tidydata.html#cb726-14"></a>                                    <span class="dt">sheet =</span> i)</span>
<span id="cb726-15"><a href="tidydata.html#cb726-15"></a>  messy_mariages[[i]]<span class="op">$</span>timestamp &lt;-<span class="st"> </span>i</span>
<span id="cb726-16"><a href="tidydata.html#cb726-16"></a>}</span></code></pre></div>
<pre><code>## New names:
## * `` -&gt; ...3
## * `` -&gt; ...5
## * `` -&gt; ...6
## * `` -&gt; ...7
## * `` -&gt; ...8</code></pre>
<p>7B) Start analyzing your tidy data</p>
<ul>
<li>How many marriages are there per year in each German “Bundesland”?</li>
<li>Visualize your findings in a plot</li>
</ul>
<p>7C) Visual analysis
Compare the marriages of 1990, 2003 and 2014 and colour them by season</p>
<p><strong>TIPS:</strong>
- Filter data by the years 1990, 2003 and 2014
- Group it by year and season and add up the values</p>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-r4ds">
<p>Hadley Wickham, Garret Grolemund &amp;. 2017. <em>R for Data Science</em>. O’Reilly. <a href="https://r4ds.had.co.nz/">https://r4ds.had.co.nz/</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="wrangling.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="importingdata.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/uashogeschoolutrecht/staRters/edit/master/ch09-tidydata.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["exploratory_data_analysis.pdf", "exploratory_data_analysis.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
